{"version":3,"file":"libpag.worker.min.js","sources":["../src/worker/events.ts","../src/worker/utils.ts","../src/utils/video-listener.ts","../src/utils/ua.ts","../src/pag-module.ts","../../third_party/tgfx/web/src/core/bitmap-image.ts","../src/worker/video-reader.ts","../src/utils/type-utils.ts","../src/core/video-reader.ts","../src/constant.ts","../src/utils/common.ts","../src/utils/decorators.ts","../src/worker/pag-file.ts","../src/worker/pag-view.ts","../src/utils/canvas.ts","../src/worker/pag-image.ts","../src/worker/client.ts"],"sourcesContent":["export enum WorkerMessageType {\n  PAGInit = 'PAGInit',\n  // PAGView static methods\n  PAGView_init = 'PAGView.init',\n  // PAGView instance methods\n  PAGView_duration = 'PAGView.duration',\n  PAGView_play = 'PAGView.play',\n  PAGView_pause = 'PAGView.pause',\n  PAGView_stop = 'PAGView.stop',\n  PAGView_setRepeatCount = 'PAGView.setRepeatCount',\n  PAGView_getProgress = 'PAGView.getProgress',\n  PAGView_currentFrame = 'PAGView.currentFrame',\n  PAGView_setProgress = 'PAGView.setProgress',\n  PAGView_scaleMode = 'PAGView.scaleMode',\n  PAGView_setScaleMode = 'PAGView.setScaleMode',\n  PAGView_flush = 'PAGView.flush',\n  PAGView_getDebugData = 'PAGView.getDebugData',\n  PAGView_destroy = 'PAGView.destroy',\n  // PAGFile static methods\n  PAGFile_load = 'PAGFile.load',\n  // PAGFile instance methods\n  PAGFile_getTextData = 'PAGFile.getTextData',\n  PAGFile_replaceText = 'PAGFile.replaceText',\n  PAGFile_replaceImage = 'PAGFile.replaceImage',\n  PAGFile_destroy = 'PAGFile.destroy',\n  // PAGImage static methods\n  PAGImage_fromSource = 'PAGImage.fromSource',\n  PAGImage_destroy = 'PAGImage.destroy',\n  // VideoReader static methods\n  VideoReader_constructor = 'VideoReader.constructor',\n  // VideoReader instance methods\n  VideoReader_prepare = 'VideoReader.prepare',\n  VideoReader_play = 'VideoReader.play',\n  VideoReader_pause = 'VideoReader.pause',\n  VideoReader_stop = 'VideoReader.stop',\n  VideoReader_getError = 'VideoReader.getError',\n  // Binding video reader\n  PAGModule_linkVideoReader = 'PAGModule.linkVideoReader',\n  // TextDocument instance methods\n  TextDocument_delete = 'TextDocument.delete',\n}\n","import type { WorkerMessage } from './worker';\n\nlet messageCount = 0;\nconst generateMessageName = (name: string) => `${name}_${messageCount++}`;\n\nexport interface WorkerInterface {\n  postMessage: (message: any, transfer: Transferable[]) => void;\n  addEventListener: (type: string, listener: (event: MessageEvent) => void) => void;\n  removeEventListener: (type: string, listener: (event: MessageEvent) => void) => void;\n}\n\nexport const postMessage = <T>(\n  worker: WorkerInterface,\n  message: WorkerMessage,\n  callback: (...args: any[]) => T,\n  transfer: (OffscreenCanvas | Transferable)[] = [],\n): Promise<T> => {\n  return new Promise((resolve) => {\n    const name = generateMessageName(message.name);\n    const handle = (event: MessageEvent<WorkerMessage>) => {\n      if (event.data.name === name) {\n        worker.removeEventListener('message', handle);\n        resolve(callback(...event.data.args));\n      }\n    };\n    worker.addEventListener('message', handle);\n    worker.postMessage({ name, args: message.args }, transfer);\n  });\n};\n","type K = keyof HTMLVideoElementEventMap;\n\nlet eventHandlers: {\n  [key in K]?: {\n    node: HTMLVideoElement;\n    handler: (this: HTMLVideoElement, ev: HTMLVideoElementEventMap[K]) => any;\n    capture: boolean;\n  }[];\n} = {};\n\nexport const addListener = (\n  node: HTMLVideoElement,\n  event: K,\n  handler: (this: HTMLVideoElement, ev: HTMLVideoElementEventMap[K]) => any,\n  capture = false,\n) => {\n  if (!(event in eventHandlers)) {\n    eventHandlers[event] = [];\n  }\n  eventHandlers[event]?.push({ node: node, handler: handler, capture: capture });\n  node.addEventListener(event, handler, capture);\n};\n\nexport const removeListener = (\n  targetNode: HTMLElement,\n  event: K,\n  targetHandler: (this: HTMLVideoElement, ev: HTMLVideoElementEventMap[K]) => any,\n) => {\n  if (!(event in eventHandlers)) return;\n  eventHandlers[event]\n    ?.filter(({ node, handler }) => node === targetNode && handler === targetHandler)\n    .forEach(({ node, handler, capture }) => node.removeEventListener(event, handler, capture));\n};\n\nexport const removeAllListeners = (targetNode: HTMLElement, event: K) => {\n  if (!(event in eventHandlers)) return;\n  eventHandlers[event]\n    ?.filter(({ node }) => node === targetNode)\n    .forEach(({ node, handler, capture }) => node.removeEventListener(event, handler, capture));\n\n  eventHandlers[event] = eventHandlers[event]?.filter(({ node }) => node !== targetNode);\n};\n","const nav = navigator?.userAgent || '';\nexport const ANDROID = /android|adr/i.test(nav);\nexport const MOBILE = /(mobile)/i.test(nav) && ANDROID;\nexport const MACOS = !(/(mobile)/i.test(nav) || MOBILE) && /Mac OS X/i.test(nav);\nexport const IPHONE = /(iphone|ipad|ipod)/i.test(nav);\nexport const WECHAT = /MicroMessenger/i.test(nav);\nexport const SAFARI_OR_IOS_WEBVIEW = /^((?!chrome|android).)*safari/i.test(nav) || IPHONE;\nexport const WORKER = typeof (globalThis as any).importScripts === 'function';\n","import type { PAG } from './types';\n\nexport let PAGModule: PAG;\n\nexport const setPAGModule = (module: PAG) => {\n  PAGModule = module;\n};\n\nexport const getPAGModule = () => PAGModule;\n","/////////////////////////////////////////////////////////////////////////////////////////////////\n//\n//  Tencent is pleased to support the open source community by making tgfx available.\n//\n//  Copyright (C) 2023 THL A29 Limited, a Tencent company. All rights reserved.\n//\n//  Licensed under the BSD 3-Clause License (the \"License\"); you may not use this file except\n//  in compliance with the License. You may obtain a copy of the License at\n//\n//      https://opensource.org/licenses/BSD-3-Clause\n//\n//  unless required by applicable law or agreed to in writing, software distributed under the\n//  license is distributed on an \"as is\" basis, without warranties or conditions of any kind,\n//  either express or implied. see the license for the specific language governing permissions\n//  and limitations under the license.\n//\n/////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport class BitmapImage {\n    public bitmap: ImageBitmap | null;\n\n    public constructor(bitmap: ImageBitmap | null) {\n        this.bitmap = bitmap;\n    }\n\n    public setBitmap(bitmap: ImageBitmap) {\n        if (this.bitmap) {\n            this.bitmap.close();\n        }\n        this.bitmap = bitmap;\n    }\n}\n","import { WorkerMessageType } from './events';\nimport { postMessage } from './utils';\n\nimport { BitmapImage } from '@tgfx/core/bitmap-image';\n\nexport class WorkerVideoReader {\n  public bitmap: ImageBitmap | null = null;\n  public isSought = false;\n  public isPlaying = false;\n\n  private proxyId: number;\n  private bitmapImage: BitmapImage = new BitmapImage(null);\n\n  public constructor(proxyId: number) {\n    this.proxyId = proxyId;\n  }\n\n  public prepare(targetFrame: number, playbackRate: number) {\n    return new Promise<void>((resolve) => {\n      postMessage(\n        self,\n        { name: WorkerMessageType.VideoReader_prepare, args: [this.proxyId, targetFrame, playbackRate] },\n        (res) => {\n          this.bitmapImage.setBitmap(res);\n          resolve();\n        },\n      );\n    });\n  }\n\n  public getVideo() {\n    return this.bitmapImage;\n  }\n\n  public onDestroy() {\n    self.postMessage({ name: 'VideoReader.onDestroy', args: [this.proxyId] });\n  }\n\n  public play() {\n    return new Promise<void>((resolve) => {\n      postMessage(self, { name: WorkerMessageType.VideoReader_play, args: [this.proxyId] }, () => {\n        resolve();\n      });\n    });\n  }\n\n  public pause() {\n    postMessage(self, { name: WorkerMessageType.VideoReader_pause, args: [this.proxyId] }, () => {});\n  }\n\n  public stop() {\n    postMessage(self, { name: WorkerMessageType.VideoReader_stop, args: [this.proxyId] }, () => {});\n  }\n\n  public getError() {\n    return new Promise<any>((resolve) => {\n      postMessage(self, { name: WorkerMessageType.VideoReader_getError, args: [this.proxyId] }, (res) => {\n        resolve(res);\n      });\n    });\n  }\n}\n","import { PAGModule } from '../pag-module';\nimport { LayerType, Vector } from '../types';\n\nimport type { PAGLayer } from '../pag-layer';\nimport type { PAGImageLayer } from '../pag-image-layer';\nimport type { PAGSolidLayer } from '../pag-solid-layer';\nimport type { PAGTextLayer } from '../pag-text-layer';\n\nconst rewindData = (fn: (...args: any[]) => any, scope: any, ...args: any[]) => {\n  if (PAGModule.Asyncify.currData !== null) {\n    const currData = PAGModule.Asyncify.currData;\n    PAGModule.Asyncify.currData = null;\n    const ret = fn.call(scope, ...args);\n    PAGModule.Asyncify.currData = currData;\n    return ret;\n  } else {\n    return fn.call(scope, ...args);\n  }\n};\n\nexport const proxyVector = <T extends (...args: any) => any>(\n  vector: Vector<any>,\n  process: T,\n): Vector<ReturnType<T>> => {\n  const proxy = new Proxy(vector, {\n    get(target, property, receiver) {\n      switch (property) {\n        case 'get':\n          return (index: number) => {\n            const wasmIns = rewindData(target.get, target, index);\n            return !wasmIns ? wasmIns : process(wasmIns);\n          };\n        case 'push_back':\n          return (value: ReturnType<T>) => {\n            rewindData(target.push_back, target, value.wasmIns || value);\n            return undefined;\n          };\n        case 'size':\n          return () => {\n            return rewindData(target.size, target);\n          };\n        default:\n          return Reflect.get(target, property, receiver);\n      }\n    },\n  });\n  return proxy;\n};\n\nexport const layer2typeLayer = (wasmIns: any): PAGSolidLayer | PAGTextLayer | PAGImageLayer | PAGLayer => {\n  switch (rewindData(wasmIns._layerType, wasmIns)) {\n    case LayerType.Solid:\n      return new PAGModule.PAGSolidLayer(wasmIns);\n    case LayerType.Text:\n      return new PAGModule.PAGTextLayer(wasmIns);\n    case LayerType.Image:\n      return new PAGModule.PAGImageLayer(wasmIns);\n    default:\n      return new PAGModule.PAGLayer(wasmIns);\n  }\n};\n\nexport const getLayerTypeName = (layerType: LayerType) => {\n  switch (layerType) {\n    case LayerType.Solid:\n      return 'Solid';\n    case LayerType.Text:\n      return 'Text';\n    case LayerType.Shape:\n      return 'Shape';\n    case LayerType.Image:\n      return 'Image';\n    case LayerType.PreCompose:\n      return 'PreCompose';\n    default:\n      return 'Unknown';\n  }\n};\n\nexport const getWasmIns = (value: any) => {\n  if (value?.wasmIns) {\n    return value.wasmIns;\n  }\n  return value;\n};\n\nexport const isInstanceOf = (value: any, type: any) => typeof type !== 'undefined' && value instanceof type;\n","import {\n  VIDEO_DECODE_WAIT_FRAME,\n  VIDEO_DECODE_SEEK_TIMEOUT_FRAME,\n  VIDEO_PLAYBACK_RATE_MAX,\n  VIDEO_PLAYBACK_RATE_MIN,\n} from '../constant';\nimport { addListener, removeListener, removeAllListeners } from '../utils/video-listener';\nimport { IPHONE, WECHAT, SAFARI_OR_IOS_WEBVIEW, WORKER } from '../utils/ua';\nimport { PAGModule } from '../pag-module';\nimport { WorkerMessageType } from '../worker/events';\nimport { WorkerVideoReader } from '../worker/video-reader';\nimport { postMessage } from '../worker/utils';\n\nimport type { TimeRange, VideoReader as VideoReaderInterfaces } from '../interfaces';\nimport type { PAGPlayer } from '../pag-player';\nimport { isInstanceOf } from '../utils/type-utils';\n\nconst UHD_RESOLUTION = 3840;\n\n// Get video initiated token on Wechat browser.\nconst getWechatNetwork = () => {\n  return new Promise<void>((resolve) => {\n    window.WeixinJSBridge.invoke(\n      'getNetworkType',\n      {},\n      () => {\n        resolve();\n      },\n      () => {\n        resolve();\n      },\n    );\n  });\n};\n\nconst waitVideoCanPlay = (videoElement: HTMLVideoElement) => {\n  return new Promise((resolve) => {\n    const canplayHandle = () => {\n      removeListener(videoElement, 'canplay', canplayHandle);\n      clearTimeout(timer);\n      resolve(true);\n    };\n    addListener(videoElement, 'canplay', canplayHandle);\n    const timer = setTimeout(() => {\n      removeListener(videoElement, 'canplay', canplayHandle);\n      resolve(false);\n    }, 1000);\n  });\n};\n\nexport class VideoReader {\n  public static async create(\n    source: Uint8Array | HTMLVideoElement,\n    width: number,\n    height: number,\n    frameRate: number,\n    staticTimeRanges: TimeRange[],\n  ): Promise<VideoReaderInterfaces> {\n    if (WORKER) {\n      const proxyId = await new Promise<number>((resolve) => {\n        // TODO: source as HTMLVideoElement in WebWorker version.\n        const uint8Array = source as Uint8Array;\n        const buffer = uint8Array.buffer.slice(uint8Array.byteOffset, uint8Array.byteOffset + uint8Array.byteLength);\n        postMessage(\n          self,\n          {\n            name: WorkerMessageType.VideoReader_constructor,\n            args: [buffer, width, height, frameRate, staticTimeRanges, true],\n          },\n          (res) => {\n            resolve(res);\n          },\n          [buffer],\n        );\n      });\n      const videoReader = new WorkerVideoReader(proxyId);\n      PAGModule.currentPlayer?.linkVideoReader(videoReader);\n      return videoReader;\n    }\n    return new VideoReader(source, width, height, frameRate, staticTimeRanges);\n  }\n\n  public isSought = false;\n  public isPlaying = false;\n  public bitmap: ImageBitmap | null = null;\n\n  private videoEl: HTMLVideoElement | null = null;\n  private frameRate = 0;\n  private canplay = false;\n  private staticTimeRanges: StaticTimeRanges | null = null;\n  private disablePlaybackRate = false;\n  private error: any = null;\n  private player: PAGPlayer | null = null;\n  private width = 0;\n  private height = 0;\n  private bitmapCanvas: OffscreenCanvas | null = null;\n  private bitmapCtx: OffscreenCanvasRenderingContext2D | null = null;\n  private seeking = false; // 标记是否正在进行seek操作\n  private pendingSeek = null; // 存储待处理的seek请求\n  private seekAttempts = 0; // 记录seek尝试的次数\n  private maxSeekAttempts = 3; // 最大seek尝试次数\n\n  public constructor(\n    source: Uint8Array | HTMLVideoElement,\n    width: number,\n    height: number,\n    frameRate: number,\n    staticTimeRanges: TimeRange[],\n    isWorker = false,\n  ) {\n    if (isInstanceOf(source, globalThis.HTMLVideoElement)) {\n      this.videoEl = source as HTMLVideoElement;\n      this.canplay = true;\n    } else {\n      this.videoEl = document.createElement('video');\n      this.videoEl.style.display = 'none';\n      this.videoEl.muted = true;\n      this.videoEl.playsInline = true;\n      this.videoEl.preload = 'auto'; // use load() will make a bug on Chrome.\n      this.videoEl.width = width;\n      this.videoEl.height = height;\n      waitVideoCanPlay(this.videoEl).then(() => {\n        this.canplay = true;\n      });\n      const blob = new Blob([source as Uint8Array], { type: 'video/mp4' });\n      this.videoEl.src = URL.createObjectURL(blob);\n      if (IPHONE) {\n        // use load() will make a bug on Chrome.\n        this.videoEl.load();\n      }\n    }\n    this.frameRate = frameRate;\n    this.width = width;\n    this.height = height;\n    this.staticTimeRanges = new StaticTimeRanges(staticTimeRanges);\n    if (UHD_RESOLUTION < width || UHD_RESOLUTION < height) {\n      this.disablePlaybackRate = true;\n    }\n    if (!isWorker) {\n      this.linkPlayer(PAGModule.currentPlayer);\n    }\n  }\n\n  public async prepare(targetFrame: number, playbackRate: number) {\n    this.setError(null); // reset error\n    this.isSought = false; // reset seek status\n    const { currentTime } = this.videoEl!;\n    const targetTime = targetFrame / this.frameRate;\n    if (currentTime === 0 && targetTime === 0) {\n      if (!this.canplay && !SAFARI_OR_IOS_WEBVIEW) {\n        await waitVideoCanPlay(this.videoEl!);\n      } else {\n        try {\n          await this.play();\n        } catch (e) {\n          this.setError(e);\n        }\n        await new Promise<void>((resolve) => {\n          requestAnimationFrame(() => {\n            this.pause();\n            resolve();\n          });\n        });\n      }\n    } else {\n      if (Math.round(targetTime * this.frameRate) === Math.round(currentTime * this.frameRate)) {\n        // Current frame\n      } else if (this.staticTimeRanges?.contains(targetFrame)) {\n        // Static frame\n        await this.seek(targetTime, false);\n        return;\n      } else if (Math.abs(currentTime - targetTime) < (1 / this.frameRate) * VIDEO_DECODE_WAIT_FRAME) {\n        // Within tolerable frame rate deviation\n      } else {\n        // Seek and play\n        this.isSought = true;\n        await this.seek(targetTime);\n        return;\n      }\n    }\n\n    const targetPlaybackRate = Math.min(Math.max(playbackRate, VIDEO_PLAYBACK_RATE_MIN), VIDEO_PLAYBACK_RATE_MAX);\n    if (!this.disablePlaybackRate && this.videoEl!.playbackRate !== targetPlaybackRate) {\n      this.videoEl!.playbackRate = targetPlaybackRate;\n    }\n\n    if (this.isPlaying && this.videoEl!.paused) {\n      try {\n        await this.play();\n      } catch (e) {\n        this.setError(e);\n      }\n    }\n  }\n\n  public getVideo() {\n    return this.videoEl;\n  }\n\n  // Only work in web worker version\n  public async generateBitmap() {\n    // Batter than createImageBitmap from video element in benchmark\n    if (!this.bitmapCanvas) {\n      this.bitmapCanvas = new OffscreenCanvas(this.width, this.height);\n      this.bitmapCanvas!.width = this.width;\n      this.bitmapCanvas!.height = this.height;\n      this.bitmapCtx = this.bitmapCanvas.getContext('2d') as OffscreenCanvasRenderingContext2D | null;\n    }\n    this.bitmapCtx?.fillRect(0, 0, this.width, this.height);\n    this.bitmapCtx?.drawImage(this.videoEl as HTMLVideoElement, 0, 0, this.width, this.height);\n    this.bitmap = await createImageBitmap(this.bitmapCanvas);\n    return this.bitmap;\n  }\n\n  public async play() {\n    if (!this.videoEl!.paused) return;\n    if (WECHAT && window.WeixinJSBridge) {\n      await getWechatNetwork();\n    }\n    if (document.visibilityState !== 'visible') {\n      const visibilityHandle = () => {\n        if (document.visibilityState === 'visible') {\n          if (this.videoEl) this.videoEl.play();\n          window.removeEventListener('visibilitychange', visibilityHandle);\n        }\n      };\n      window.addEventListener('visibilitychange', visibilityHandle);\n      throw new Error('The play() request was interrupted because the document was hidden!');\n    }\n    await this.videoEl?.play();\n  }\n\n  public pause() {\n    this.isPlaying = false;\n    if (this.videoEl!.paused) return;\n    this.videoEl?.pause();\n  }\n\n  public stop() {\n    this.isPlaying = false;\n    if (!this.videoEl!.paused) {\n      this.videoEl?.pause();\n    }\n    this.videoEl!.currentTime = 0;\n  }\n\n  public getError() {\n    return this.error;\n  }\n\n  public onDestroy() {\n    if (this.player) {\n      this.player.unlinkVideoReader(this);\n    }\n    removeAllListeners(this.videoEl!, 'playing');\n    removeAllListeners(this.videoEl!, 'timeupdate');\n    this.videoEl = null;\n    this.bitmapCanvas = null;\n    this.bitmapCtx = null;\n  }\n\n  \n  private async seek(targetTime: number, play = true) {\n    // 如果当前正在进行seek操作，存储这个请求以便后续处理\n    if (this.seeking) {\n      this.pendingSeek = { targetTime, play };\n      return;\n    }\n\n    this.seeking = true; // 标记正在进行seek操作\n    this.seekAttempts++; // 增加seek尝试次数\n\n    // 如果超过最大尝试次数，不再尝试seek，直接返回\n    if (this.seekAttempts > this.maxSeekAttempts) {\n      console.error('Maximum seek attempts reached, giving up on seek.');\n      this.seeking = false;\n      this.seekAttempts = 0;\n      return;\n    }\n\n    if (!this.videoEl) {\n      console.error('Video element is not initialized.');\n      this.seeking = false;\n      return;\n    }\n\n    const onSeeked = () => {\n      removeListener(this.videoEl!, 'seeked', onSeeked);\n      clearTimeout(seekTimeout);\n      this.seeking = false; // 重置seek状态\n      this.seekAttempts = 0; // 重置seek尝试次数\n\n      if (play) {\n        this.videoEl?.play().catch((e) => {\n          this.setError(e);\n        });\n      } else if (!play && !this.videoEl!.paused) {\n        this.videoEl?.pause();\n      }\n\n      // 如果有待处理的seek请求，立即执行它\n      if (this.pendingSeek) {\n        const { targetTime, play } = this.pendingSeek;\n        this.pendingSeek = null; // 清空待处理的seek请求\n        this.seek(targetTime, play); // 执行新的seek操作\n      }\n    };\n\n    const onCanPlay = () => {\n      removeListener(this.videoEl!, 'canplay', onCanPlay);\n      this.videoEl!.currentTime = targetTime;\n      addListener(this.videoEl!, 'seeked', onSeeked);\n    };\n\n    const seekTimeout = setTimeout(() => {\n      removeListener(this.videoEl!, 'canplay', onCanPlay);\n      removeListener(this.videoEl!, 'seeked', onSeeked);\n      console.warn('Seek operation timed out, retrying...');\n      this.seeking = false; // 重置seek状态\n      // 尝试重新seek，而不是抛出错误\n      this.seek(targetTime, play);\n    }, (1000 / this.frameRate) * VIDEO_DECODE_SEEK_TIMEOUT_FRAME);\n\n    // Check if we need to wait for 'canplay' event before seeking.\n    if (this.videoEl.readyState < HTMLMediaElement.HAVE_FUTURE_DATA) {\n      addListener(this.videoEl, 'canplay', onCanPlay);\n    } else {\n      // We already have enough data to perform the seek.\n      this.videoEl!.currentTime = targetTime;\n      addListener(this.videoEl, 'seeked', onSeeked);\n    }\n  }\n\n  private setError(e: any) {\n    this.error = e;\n  }\n\n  private linkPlayer(player: PAGPlayer | null) {\n    this.player = player;\n    if (player) {\n      player.linkVideoReader(this);\n    }\n  }\n}\n\nexport class StaticTimeRanges {\n  private timeRanges: TimeRange[];\n\n  public constructor(timeRanges: TimeRange[]) {\n    this.timeRanges = timeRanges;\n  }\n\n  public contains(targetFrame: number) {\n    if (this.timeRanges.length === 0) return false;\n    for (let timeRange of this.timeRanges) {\n      if (timeRange.start <= targetFrame && targetFrame < timeRange.end) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","/**\n * VideoDecode wait frame num.\n */\nexport const VIDEO_DECODE_WAIT_FRAME = 3;\n/**\n * VideoDecode seek timeout frame num.\n */\nexport const VIDEO_DECODE_SEEK_TIMEOUT_FRAME = 12;\n/**\n * NAL unit length. [ 0, 0, 0, 1 ]\n */\nexport const NALU_HEADER_LENGTH = 4;\n/**\n * Web safe font.\n */\nexport const WEB_SAFE_FONT = 'Arial';\n/**\n * Default render canvas size.\n */\nexport const DEFAULT_CANVAS_SIZE = 2560;\n/**\n * Default WebGL ContextAttributes\n */\nexport const WEBGL_CONTEXT_ATTRIBUTES = {\n  depth: false,\n  stencil: false,\n  antialias: false,\n};\n\nexport const VIDEO_PLAYBACK_RATE_MIN = 0.125;\nexport const VIDEO_PLAYBACK_RATE_MAX = 4;\n\nexport const CANVAS_POOL_MAX_SIZE = 10;\n","import { isInstanceOf } from './type-utils';\n\nexport const readFile = (file: File) =>\n  new Promise<ArrayBuffer | null>((resolve) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      resolve(reader.result as ArrayBuffer | null);\n    };\n    reader.onerror = () => {\n      console.error((reader.error as DOMException).message);\n    };\n    reader.readAsArrayBuffer(file);\n  });\n\nexport const transferToArrayBuffer = (data: File | Blob | ArrayBuffer) => {\n  if (isInstanceOf(data, globalThis.File)) {\n    return readFile(data as File);\n  } else if (isInstanceOf(data, globalThis.Blob)) {\n    return readFile(new File([data as Blob], ''));\n  } else if (isInstanceOf(data, globalThis.ArrayBuffer)) {\n    return Promise.resolve(data as ArrayBuffer);\n  }\n  return Promise.resolve(null);\n};\n\nexport const concatUint8Arrays = (arrays: Array<Uint8Array>) => {\n  let totalLength = 0;\n  for (const arr of arrays) {\n    totalLength += arr.byteLength;\n  }\n  const result = new Uint8Array(totalLength);\n  let offset = 0;\n  for (const arr of arrays) {\n    result.set(arr, offset);\n    offset += arr.byteLength;\n  }\n  return result;\n};\n","import { PAGModule } from '../pag-module';\n\nexport function wasmAwaitRewind(constructor: any) {\n  const ignoreStaticFunctions = ['length', 'name', 'prototype', 'wasmAsyncMethods'];\n  let staticFunctions = Object.getOwnPropertyNames(constructor).filter(\n    (name) => ignoreStaticFunctions.indexOf(name) === -1,\n  );\n  if (constructor.wasmAsyncMethods && constructor.wasmAsyncMethods.length > 0) {\n    staticFunctions = staticFunctions.filter((name) => constructor.wasmAsyncMethods.indexOf(name) === -1);\n  }\n\n  let functions = Object.getOwnPropertyNames(constructor.prototype).filter(\n    (name) => name !== 'constructor' && typeof constructor.prototype[name] === 'function',\n  );\n  if (constructor.prototype.wasmAsyncMethods && constructor.prototype.wasmAsyncMethods.length > 0) {\n    functions = functions.filter((name) => constructor.prototype.wasmAsyncMethods.indexOf(name) === -1);\n  }\n\n  const proxyFn = (target: { [prop: string]: (...args: any[]) => any }, methodName: string) => {\n    const fn = target[methodName];\n    target[methodName] = function (...args) {\n      if (PAGModule.Asyncify.currData !== null) {\n        const currData = PAGModule.Asyncify.currData;\n        PAGModule.Asyncify.currData = null;\n        const ret = fn.call(this, ...args);\n        PAGModule.Asyncify.currData = currData;\n        return ret;\n      } else {\n        return fn.call(this, ...args);\n      }\n    };\n  };\n\n  staticFunctions.forEach((name) => proxyFn(constructor, name));\n  functions.forEach((name) => proxyFn(constructor.prototype, name));\n}\n\nexport function wasmAsyncMethod(target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n  if (!target.wasmAsyncMethods) {\n    target.wasmAsyncMethods = [];\n  }\n  target.wasmAsyncMethods.push(propertyKey);\n}\n\nexport function destroyVerify(constructor: any) {\n  let functions = Object.getOwnPropertyNames(constructor.prototype).filter(\n    (name) => name !== 'constructor' && typeof constructor.prototype[name] === 'function',\n  );\n\n  const proxyFn = (target: { [prop: string]: any }, methodName: string) => {\n    const fn = target[methodName];\n    target[methodName] = function (...args: any[]) {\n      if (this['isDestroyed']) {\n        console.error(`Don't call ${methodName} of the ${constructor.name} that is destroyed.`);\n        return;\n      }\n      return fn.call(this, ...args);\n    };\n  };\n  functions.forEach((name) => proxyFn(constructor.prototype, name));\n}\n","import { WorkerMessageType } from './events';\nimport { postMessage } from './utils';\nimport { transferToArrayBuffer } from '../utils/common';\nimport { destroyVerify } from '../utils/decorators';\n\nimport type { WorkerPAGImage } from './pag-image';\nimport type { TextDocument } from '../types';\n\n@destroyVerify\nexport class WorkerPAGFile {\n  /**\n   * Load pag file from file.\n   */\n  public static async load(worker: Worker, data: File | Blob | ArrayBuffer) {\n    const buffer = await transferToArrayBuffer(data);\n    if (!buffer)\n      throw new Error(\n        'Initialize PAGFile data type error, please put check data type must to be File ｜ Blob | ArrayBuffer!',\n      );\n    return await postMessage(\n      worker,\n      { name: WorkerMessageType.PAGFile_load, args: [data] },\n      (key) => new WorkerPAGFile(worker, key),\n    );\n  }\n\n  public key: number;\n  public worker: Worker;\n  public isDestroyed = false;\n\n  public constructor(worker: Worker, key: number) {\n    this.worker = worker;\n    this.key = key;\n  }\n  /**\n   * Get a text data of the specified index. The index ranges from 0 to numTexts - 1.\n   * Note: It always returns the default text data.\n   */\n  public getTextData(editableTextIndex: number) {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGFile_getTextData, args: [this.key, editableTextIndex] },\n      (res: TextDocument & { key: number }) => {\n        res.delete = () => {\n          return postMessage(\n            this.worker,\n            { name: WorkerMessageType.TextDocument_delete, args: [res.key] },\n            () => undefined,\n          );\n        };\n        return res;\n      },\n    );\n  }\n  /**\n   * Replace the text data of the specified index. The index ranges from 0 to PAGFile.numTexts - 1.\n   * Passing in null for the textData parameter will reset it to default text data.\n   */\n  public replaceText(editableTextIndex: number, textData: TextDocument & { [prop: string]: any }): Promise<void> {\n    const textDocument: { [prop: string]: any } = {};\n    for (const key in textData) {\n      if (key !== 'delete') {\n        textDocument[key] = textData[key];\n      }\n    }\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGFile_replaceText, args: [this.key, editableTextIndex, textDocument] },\n      () => undefined,\n    );\n  }\n  /**\n   * Replace the image content of the specified index with a PAGImage object. The index ranges from\n   * 0 to PAGFile.numImages - 1. Passing in null for the image parameter will reset it to default\n   * image content.\n   */\n  public replaceImage(editableImageIndex: number, pagImage: WorkerPAGImage) {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGFile_replaceImage, args: [this.key, editableImageIndex, pagImage.key] },\n      () => undefined,\n    );\n  }\n\n  public destroy(): Promise<void> {\n    return postMessage(this.worker, { name: WorkerMessageType.PAGFile_destroy, args: [this.key] }, () => {\n      this.isDestroyed = true;\n    });\n  }\n}\n","import { WorkerMessageType } from './events';\nimport { postMessage } from './utils';\nimport { destroyVerify } from '../utils/decorators';\nimport { calculateDisplaySize } from '../utils/canvas';\n\nimport type { WorkerPAGFile } from './pag-file';\nimport type { PAGViewOptions } from '../pag-view';\nimport type { DebugData, PAGScaleMode } from '../types';\n\n@destroyVerify\nexport class WorkerPAGView {\n  /**\n   * Create pag view.\n   * @param file pag file.\n   * @param canvas target render canvas.\n   * @param initOptions pag view options\n   * @returns\n   */\n  public static init(file: WorkerPAGFile, canvas: HTMLCanvasElement, initOptions?: PAGViewOptions) {\n    const options = {\n      ...{\n        useScale: true,\n        useCanvas2D: false,\n        firstFrame: true,\n      },\n      ...initOptions,\n    };\n    if (options.useScale) {\n      resizeCanvas(canvas);\n    }\n    const offscreen = canvas.transferControlToOffscreen();\n    return postMessage(\n      file.worker,\n      { name: WorkerMessageType.PAGView_init, args: [file.key, offscreen, initOptions] },\n      (key: number) => new WorkerPAGView(file.worker, key),\n      [offscreen],\n    );\n  }\n\n  public key: number;\n  public worker: Worker;\n  public isDestroyed = false;\n\n  public constructor(worker: Worker, key: number) {\n    this.worker = worker;\n    this.key = key;\n  }\n  /**\n   * The duration of current composition in microseconds.\n   */\n  public duration() {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_duration, args: [this.key] },\n      (res: number) => res,\n    );\n  }\n  /**\n   * Start the animation.\n   */\n  public play() {\n    return postMessage(this.worker, { name: WorkerMessageType.PAGView_play, args: [this.key] }, () => undefined);\n  }\n  /**\n   * Pause the animation.\n   */\n  public pause(): Promise<void> {\n    return postMessage(this.worker, { name: WorkerMessageType.PAGView_pause, args: [this.key] }, () => undefined);\n  }\n  /**\n   * Stop the animation.\n   */\n  public stop(): Promise<void> {\n    return postMessage(this.worker, { name: WorkerMessageType.PAGView_stop, args: [this.key] }, () => undefined);\n  }\n  /**\n   * Set the number of times the animation will repeat. The default is 1, which means the animation\n   * will play only once. 0 means the animation will play infinity times.\n   */\n  public setRepeatCount(repeatCount: number): Promise<void> {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_setRepeatCount, args: [this.key, repeatCount] },\n      () => undefined,\n    );\n  }\n  /**\n   * Returns the current progress of play position, the value is from 0.0 to 1.0. It is applied only\n   * when the composition is not null.\n   */\n  public getProgress() {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_getProgress, args: [this.key] },\n      (res: number) => res,\n    );\n  }\n  /**\n   * Returns the current frame.\n   */\n  public currentFrame() {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_currentFrame, args: [this.key] },\n      (res: number) => res,\n    );\n  }\n  /**\n   * Set the progress of play position, the value is from 0.0 to 1.0.\n   */\n  public setProgress(progress: number) {\n    return postMessage(\n      this.worker,\n      {\n        name: WorkerMessageType.PAGView_setProgress,\n        args: [this.key, progress],\n      },\n      () => undefined,\n    );\n  }\n  /**\n   * Returns the current scale mode.\n   */\n  public scaleMode() {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_scaleMode, args: [this.key] },\n      (res: number) => res,\n    );\n  }\n  /**\n   * Specifies the rule of how to scale the pag content to fit the surface size. The matrix\n   * changes when this method is called.\n   */\n  public setScaleMode(value: PAGScaleMode): Promise<void> {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_setScaleMode, args: [this.key, value] },\n      () => undefined,\n    );\n  }\n  /**\n   * Call this method to render current position immediately. If the play() method is already\n   * called, there is no need to call it. Returns true if the content has changed.\n   */\n  public flush() {\n    return postMessage(this.worker, { name: WorkerMessageType.PAGView_flush, args: [this.key] }, (res: boolean) => res);\n  }\n\n  public getDebugData() {\n    return postMessage(\n      this.worker,\n      { name: WorkerMessageType.PAGView_getDebugData, args: [this.key] },\n      (res: DebugData) => res,\n    );\n  }\n\n  public destroy() {\n    postMessage(this.worker, { name: WorkerMessageType.PAGView_destroy, args: [this.key] }, () => {\n      this.isDestroyed = true;\n    });\n  }\n}\n\nconst resizeCanvas = (canvas: HTMLCanvasElement) => {\n  const displaySize = calculateDisplaySize(canvas);\n  canvas.style.width = `${displaySize.width}px`;\n  canvas.style.height = `${displaySize.height}px`;\n  canvas.width = displaySize.width * globalThis.devicePixelRatio;\n  canvas.height = displaySize.height * globalThis.devicePixelRatio;\n};\n","export const calculateDisplaySize = (canvas: HTMLCanvasElement) => {\n  const styleDeclaration = globalThis.getComputedStyle(canvas, null);\n  const computedSize = {\n    width: Number(styleDeclaration.width.replace('px', '')),\n    height: Number(styleDeclaration.height.replace('px', '')),\n  };\n  if (computedSize.width > 0 && computedSize.height > 0) {\n    return computedSize;\n  } else {\n    const styleSize = {\n      width: Number(canvas.style.width.replace('px', '')),\n      height: Number(canvas.style.height.replace('px', '')),\n    };\n    if (styleSize.width > 0 && styleSize.height > 0) {\n      return styleSize;\n    } else {\n      return {\n        width: canvas.width,\n        height: canvas.height,\n      };\n    }\n  }\n};\n","import { destroyVerify } from '../utils/decorators';\nimport { isInstanceOf } from '../utils/type-utils';\nimport { WorkerMessageType } from './events';\nimport { postMessage } from './utils';\n\n@destroyVerify\nexport class WorkerPAGImage {\n  public static async fromSource(worker: Worker, source: TexImageSource) {\n    const width = isInstanceOf(source, globalThis.HTMLVideoElement)\n      ? (source as HTMLVideoElement).videoWidth\n      : source.width;\n    const height = isInstanceOf(source, globalThis.HTMLVideoElement)\n      ? (source as HTMLVideoElement).videoHeight\n      : source.height;\n    const canvas = new OffscreenCanvas(width, height);\n    canvas.width = source.width;\n    canvas.height = source.height;\n    const ctx = canvas.getContext('2d') as OffscreenCanvasRenderingContext2D;\n    ctx.drawImage(source as CanvasImageSource, 0, 0, source.width, source.height);\n    const bitmap = await createImageBitmap(canvas);\n    return postMessage(\n      worker,\n      { name: WorkerMessageType.PAGImage_fromSource, args: [bitmap] },\n      (key: number) => new WorkerPAGImage(worker, key),\n      [bitmap],\n    );\n  }\n\n  public worker: Worker;\n  public key: number;\n  public isDestroyed = false;\n\n  public constructor(worker: Worker, key: number) {\n    this.worker = worker;\n    this.key = key;\n  }\n\n  public destroy(): Promise<void> {\n    return postMessage(this.worker, { name: WorkerMessageType.PAGImage_destroy, args: [this.key] }, () => {\n      this.isDestroyed = true;\n    });\n  }\n}\n","import { WorkerMessageType } from './events';\nimport { postMessage } from './utils';\nimport { VideoReader } from '../core/video-reader';\nimport { WorkerPAGFile } from './pag-file';\nimport { WorkerPAGView } from './pag-view';\nimport { WorkerPAGImage } from './pag-image';\n\nimport type { WorkerMessage } from './worker';\nimport type { ModuleOption } from '../pag';\nimport type { TimeRange } from '../interfaces';\n\nexport const MAX_ACTIVE_WORKER_CONTEXTS = 4;\n\nconst videoReaders: VideoReader[] = [];\n\nexport interface PAGWorkerOptions {\n  /**\n   * Link to wasm file and libpag core script.\n   */\n  locateFile?: (file: 'libpag.wasm' | 'libpag.js') => string;\n  /**\n   * Configure for worker.\n   */\n  workerOptions?: WorkerOptions;\n}\n\nexport const createPAGWorker = (pagWorkerOptions: PAGWorkerOptions = {}) => {\n  let scriptUrl = pagWorkerOptions.locateFile ? pagWorkerOptions.locateFile('libpag.js') : 'libpag.js';\n  const option: { fileUrl?: string } & ModuleOption = {};\n  if (pagWorkerOptions.locateFile) {\n    option.fileUrl = pagWorkerOptions.locateFile('libpag.wasm');\n  }\n  const worker = new Worker(scriptUrl, pagWorkerOptions.workerOptions);\n  return postMessage(worker, { name: WorkerMessageType.PAGInit, args: [option] }, () => {\n    addGlobalWorkerListener(worker);\n    return worker;\n  });\n};\n\nconst addGlobalWorkerListener = (worker: Worker) => {\n  const handle = (event: MessageEvent<WorkerMessage>) => {\n    if (event.data.name.includes(WorkerMessageType.VideoReader_constructor)) {\n      const videoReader = new VideoReader(\n        ...(event.data.args as [Uint8Array, number, number, number, TimeRange[], boolean]),\n      );\n      videoReaders.push(videoReader);\n      worker.postMessage({ name: event.data.name, args: [videoReaders.length - 1] });\n      return;\n    }\n    if (event.data.name.includes(WorkerMessageType.VideoReader_prepare)) {\n      const [proxyId, targetFrame, playbackRate] = event.data.args as [number, number, number];\n      videoReaders[proxyId].prepare(targetFrame, playbackRate).then(() => {\n        videoReaders[proxyId].generateBitmap().then((bitmap) => {\n          worker.postMessage({ name: event.data.name, args: [bitmap] }, [bitmap]);\n        });\n      });\n    }\n    if (event.data.name.includes(WorkerMessageType.VideoReader_play)) {\n      videoReaders[event.data.args[0]].play().then((res) => {\n        worker.postMessage({ name: event.data.name, args: [res] });\n      });\n    }\n    if (event.data.name.includes(WorkerMessageType.VideoReader_pause)) {\n      videoReaders[event.data.args[0]].pause();\n    }\n    if (event.data.name.includes(WorkerMessageType.VideoReader_stop)) {\n      videoReaders[event.data.args[0]].stop();\n    }\n    if (event.data.name.includes(WorkerMessageType.VideoReader_getError)) {\n      worker.postMessage({ name: event.data.name, args: [videoReaders[event.data.args[0]].getError()] });\n    }\n  };\n  worker.addEventListener('message', handle);\n};\n\nexport { WorkerPAGFile, WorkerPAGView, WorkerPAGImage };\n"],"names":["WorkerMessageType","messageCount","postMessage","worker","message","callback","transfer","Promise","resolve","name","generateMessageName","handle","event","data","removeEventListener","args","addEventListener","eventHandlers","addListener","node","handler","capture","_a","push","removeListener","targetNode","targetHandler","filter","forEach","removeAllListeners","_b","nav","navigator","userAgent","ANDROID","test","MOBILE","IPHONE","WECHAT","SAFARI_OR_IOS_WEBVIEW","WORKER","globalThis","importScripts","PAGModule","BitmapImage","constructor","bitmap","this","setBitmap","close","WorkerVideoReader","proxyId","isSought","isPlaying","bitmapImage","prepare","targetFrame","playbackRate","self","VideoReader_prepare","res","getVideo","onDestroy","play","VideoReader_play","pause","VideoReader_pause","stop","VideoReader_stop","getError","VideoReader_getError","isInstanceOf","value","type","waitVideoCanPlay","videoElement","canplayHandle","clearTimeout","timer","setTimeout","VideoReader","source","width","height","frameRate","staticTimeRanges","isWorker","videoEl","canplay","disablePlaybackRate","error","player","bitmapCanvas","bitmapCtx","seeking","pendingSeek","seekAttempts","maxSeekAttempts","HTMLVideoElement","document","createElement","style","display","muted","playsInline","preload","then","blob","Blob","src","URL","createObjectURL","load","StaticTimeRanges","linkPlayer","currentPlayer","static","uint8Array","buffer","slice","byteOffset","byteLength","VideoReader_constructor","videoReader","linkVideoReader","async","setError","currentTime","targetTime","e","requestAnimationFrame","Math","round","contains","seek","abs","targetPlaybackRate","min","max","paused","OffscreenCanvas","getContext","fillRect","drawImage","createImageBitmap","window","WeixinJSBridge","invoke","visibilityState","visibilityHandle","Error","unlinkVideoReader","console","onSeeked","seekTimeout","catch","onCanPlay","warn","readyState","HTMLMediaElement","HAVE_FUTURE_DATA","timeRanges","length","timeRange","start","end","readFile","file","reader","FileReader","onload","result","onerror","readAsArrayBuffer","destroyVerify","functions","Object","getOwnPropertyNames","prototype","proxyFn","target","methodName","fn","call","WorkerPAGFile","key","isDestroyed","File","ArrayBuffer","transferToArrayBuffer","PAGFile_load","getTextData","editableTextIndex","PAGFile_getTextData","delete","TextDocument_delete","replaceText","textData","textDocument","PAGFile_replaceText","replaceImage","editableImageIndex","pagImage","PAGFile_replaceImage","destroy","PAGFile_destroy","exports","__decorateClass","WorkerPAGView","canvas","initOptions","__spreadValues","useScale","useCanvas2D","firstFrame","resizeCanvas","offscreen","transferControlToOffscreen","PAGView_init","duration","PAGView_duration","PAGView_play","PAGView_pause","PAGView_stop","setRepeatCount","repeatCount","PAGView_setRepeatCount","getProgress","PAGView_getProgress","currentFrame","PAGView_currentFrame","setProgress","progress","PAGView_setProgress","scaleMode","PAGView_scaleMode","setScaleMode","PAGView_setScaleMode","flush","PAGView_flush","getDebugData","PAGView_getDebugData","PAGView_destroy","displaySize","styleDeclaration","getComputedStyle","computedSize","Number","replace","styleSize","calculateDisplaySize","devicePixelRatio","WorkerPAGImage","videoWidth","videoHeight","PAGImage_fromSource","PAGImage_destroy","videoReaders","addGlobalWorkerListener","includes","generateBitmap","pagWorkerOptions","scriptUrl","locateFile","option","fileUrl","Worker","workerOptions","PAGInit"],"mappings":"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"}