!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).libpag={})}(this,(function(t){"use strict";let e;try{e=performance.now.bind(performance)}catch(t){e=Date.now}class i{constructor(){this.startTime=e(),this.markers={}}reset(){this.startTime=e(),this.markers={}}mark(t){t?Object.keys(this.markers).find((e=>e===t))?console.log(`Clock.mark(): The specified marker name '${t}' already exists!`):this.markers[t]=e():console.log("Clock.mark(): An empty marker name was specified!")}measure(t,i){let r,n;if(t){if(!Object.keys(this.markers).find((e=>e===t)))return console.log(`Clock.measure(): The specified makerFrom '${t}' does not exist!`),0;r=this.markers[t]}else r=this.startTime;if(i){if(!Object.keys(this.markers).find((t=>t===i)))return console.log(`Clock.measure(): The specified makerTo '${i}' does not exist!`),0;n=this.markers[i]}else n=e();return n-r}}var r=(t=>(t[t.Unknown=0]="Unknown",t[t.Vector=1]="Vector",t[t.Bitmap=2]="Bitmap",t[t.Video=3]="Video",t))(r||{}),n=(t=>(t[t.End=0]="End",t[t.FontTables=1]="FontTables",t[t.VectorCompositionBlock=2]="VectorCompositionBlock",t[t.CompositionAttributes=3]="CompositionAttributes",t[t.ImageTables=4]="ImageTables",t[t.LayerBlock=5]="LayerBlock",t[t.LayerAttributes=6]="LayerAttributes",t[t.SolidColor=7]="SolidColor",t[t.TextSource=8]="TextSource",t[t.TextPathOption=9]="TextPathOption",t[t.TextMoreOption=10]="TextMoreOption",t[t.ImageReference=11]="ImageReference",t[t.CompositionReference=12]="CompositionReference",t[t.Transform2D=13]="Transform2D",t[t.MaskBlock=14]="MaskBlock",t[t.ShapeGroup=15]="ShapeGroup",t[t.Rectangle=16]="Rectangle",t[t.Ellipse=17]="Ellipse",t[t.PolyStar=18]="PolyStar",t[t.ShapePath=19]="ShapePath",t[t.Fill=20]="Fill",t[t.Stroke=21]="Stroke",t[t.GradientFill=22]="GradientFill",t[t.GradientStroke=23]="GradientStroke",t[t.MergePaths=24]="MergePaths",t[t.TrimPaths=25]="TrimPaths",t[t.Repeater=26]="Repeater",t[t.RoundCorners=27]="RoundCorners",t[t.Performance=28]="Performance",t[t.DropShadowStyle=29]="DropShadowStyle",t[t.InnerShadowStyle=30]="InnerShadowStyle",t[t.OuterGlowStyle=31]="OuterGlowStyle",t[t.InnerGlowStyle=32]="InnerGlowStyle",t[t.BevelAndEmbossStyle=33]="BevelAndEmbossStyle",t[t.SatinStyle=34]="SatinStyle",t[t.ColorOverlayStyle=35]="ColorOverlayStyle",t[t.GradientOverlayStyle=36]="GradientOverlayStyle",t[t.StrokeStyle=37]="StrokeStyle",t[t.TintEffect=38]="TintEffect",t[t.FillEffect=39]="FillEffect",t[t.StrokeEffect=40]="StrokeEffect",t[t.TritoneEffect=41]="TritoneEffect",t[t.DropShadowEffect=42]="DropShadowEffect",t[t.RadialWipeEffect=43]="RadialWipeEffect",t[t.DisplacementMapEffect=44]="DisplacementMapEffect",t[t.BitmapCompositionBlock=45]="BitmapCompositionBlock",t[t.BitmapSequence=46]="BitmapSequence",t[t.ImageBytes=47]="ImageBytes",t[t.ImageBytes2=48]="ImageBytes2",t[t.ImageBytes3=49]="ImageBytes3",t[t.VideoCompositionBlock=50]="VideoCompositionBlock",t[t.VideoSequence=51]="VideoSequence",t[t.LayerAttributesV2=52]="LayerAttributesV2",t[t.Count=53]="Count",t))(n||{});const s=t=>{const e=t.readUint16();let i=(63&e)>>>0;const r=e>>6;return 63===i&&(i=t.readUint32()),t.context.tagLevel<r&&(t.context.tagLevel=r),{code:r,length:i}};function o(t,e,i){let r=s(t);for(;r.code!==n.End;){const n=t.readBytes(r.length);i(n,r.code,e),t.context.tagLevel<n.context.tagLevel&&(t.context.tagLevel=n.context.tagLevel),r=s(t)}}const a={alpha:!0,depth:!1,stencil:!1,antialias:!0};var h=(t=>(t[t.Normal=0]="Normal",t[t.Multiply=1]="Multiply",t[t.Screen=2]="Screen",t[t.Overlay=3]="Overlay",t[t.Darken=4]="Darken",t[t.Lighten=5]="Lighten",t[t.ColorDodge=6]="ColorDodge",t[t.ColorBurn=7]="ColorBurn",t[t.HardLight=8]="HardLight",t[t.SoftLight=9]="SoftLight",t[t.Difference=10]="Difference",t[t.Exclusion=11]="Exclusion",t[t.Hue=12]="Hue",t[t.Saturation=13]="Saturation",t[t.Color=14]="Color",t[t.Luminosity=15]="Luminosity",t[t.DestinationIn=21]="DestinationIn",t[t.DestinationOut=22]="DestinationOut",t[t.DestinationATop=23]="DestinationATop",t[t.SourceIn=24]="SourceIn",t[t.SourceOut=25]="SourceOut",t[t.Xor=26]="Xor",t))(h||{}),l=(t=>(t[t.None=0]="None",t[t.Linear=1]="Linear",t[t.Bezier=2]="Bezier",t[t.Hold=3]="Hold",t))(l||{});const c=navigator&&/(ios|ipad|iphone)/.test(navigator.userAgent.toLowerCase()),d={red:0,green:0,blue:0},u={red:255,green:255,blue:255},f=()=>{console.error("PAG Verify Failed!")},p=t=>!!t||(console.error("PAG Verify Failed!"),!1),m=class{constructor(){this.id=0,this.width=0,this.height=0,this.duration=0,this.frameRate=30,this.backgroundColor=u,this.cacheID=0,this.cacheID=m.cacheIDCount,m.cacheIDCount+=1}type(){return r.Unknown}getStaticTimeRanges(){return[]}verify(){return p(this.width>0&&this.height>0&&this.duration>0&&this.frameRate>0)}};let g=m;g.cacheIDCount=1;class y extends g{constructor(){super(...arguments),this.hasAlpha=!1,this.sequences=[],this.staticTimeRanges=[],this.staticTimeRangeUpdated=!1}type(){return r.Video}getStaticTimeRanges(){return this.staticTimeRangeUpdated||(this.staticTimeRangeUpdated=!0,this.updateStaticTimeRanges()),this.staticTimeRanges}updateStaticTimeRanges(){if(!(this.duration<=1))if(this.sequences.length>0){let t=this.sequences[0];for(let e=1;e<this.sequences.length;e++){const i=this.sequences[e];i.frameRate>t.frameRate&&(t=i)}const e=this.frameRate/t.frameRate;for(const i of t.staticTimeRanges)i.start=Math.round(i.start*e),i.end=Math.round(i.end*e),this.staticTimeRanges.push(i)}else{const t={start:0,end:this.duration-1};this.staticTimeRanges.push(t)}}hasImageContent(){return!0}verify(){if(!super.verify()||this.sequences.length<=0)return f(),!1;for(const t of this.sequences)if(!t||!t.verify())return f(),!1;return!0}}class v{constructor(t,e){this.numerator=1,this.denominator=1,this.numerator=t,this.denominator=e}value(){return this.numerator/this.denominator}}const w=new v(1,1);class b{constructor(t,e){this.x=t,this.y=e}}const S=new b(0,0);var x=(t=>(t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.AlphaInverted=2]="AlphaInverted",t[t.Luma=3]="Luma",t[t.LumaInverted=4]="LumaInverted",t))(x||{}),E=(t=>(t[t.Unknown=0]="Unknown",t[t[void 0]=1]="undefined",t[t.Solid=2]="Solid",t[t.Text=3]="Text",t[t.Shape=4]="Shape",t[t.Image=5]="Image",t[t.PreCompose=6]="PreCompose",t))(E||{});class T{constructor(){this.id=0,this.parent=void 0,this.containingComposition=void 0,this.stretch=w,this.startTime=0,this.duration=0,this.autoOrientation=!1,this.transform=void 0,this.isActive=!0,this.blendMode=h.Normal,this.trackMatteType=0,this.trackMatteLayer=void 0,this.timeRemap=void 0,this.masks=void 0,this.effects=void 0,this.layerStyles=void 0,this.layerCache=void 0,this.maxScale=void 0}type(){return 0}excludeVaryingRanges(t){var e;if(null==(e=this.transform)||e.excludeVaryingRanges(t),void 0!==this.timeRemap&&this.timeRemap.excludeVaryingRanges(t),void 0!==this.masks)for(const e of this.masks)e.excludeVaryingRanges(t);if(void 0!==this.effects&&this.effects.length>0)for(const e of this.effects)e.excludeVaryingRanges(t);if(void 0!==this.layerStyles&&this.layerStyles.length>0)for(const e of this.layerStyles)e.excludeVaryingRanges(t)}gotoFrame(t){var e;if(null==(e=this.transform)||e.gotoFrame(t),void 0!==this.timeRemap&&this.timeRemap.gotoFrame(t),void 0!==this.masks&&this.masks.length>0)for(const e of this.masks)e.gotoFrame(t);if(void 0!==this.effects&&this.effects.length>0)for(const e of this.effects)e.gotoFrame(t);if(void 0!==this.layerStyles&&this.layerStyles.length>0)for(const e of this.layerStyles)e.gotoFrame(t)}verify(){if(!this.containingComposition||this.duration<=0||!this.transform)return f(),!1;if(!this.transform.verify())return f(),!1;if(this.masks&&this.masks.length>0)for(const t of this.masks)if(!t||!t.verify())return f(),!1;if(this.layerStyles&&this.layerStyles.length>0)for(const t of this.layerStyles)if(!t||!t.verify())return f(),!1;if(this.effects&&this.effects.length>0)for(const t of this.effects)if(!t||!t.verify())return f(),!1;return!0}getMaxScaleFactor(){if(void 0!==this.maxScale)return this.maxScale;this.maxScale=new b(1,1);const t=this.transform.scale;if(t.animatable()){const{keyframes:e}=t;let i=Math.abs(e[0].startValue.x),r=Math.abs(e[0].startValue.y);if(void 0!==e&&e.length>0)for(const t of e){const e=Math.abs(t.endValue.x),n=Math.abs(t.endValue.y);i<e&&(i=e),r<n&&(r=n)}this.maxScale.x=i,this.maxScale.y=r}else this.maxScale.x=Math.abs(t.value.x),this.maxScale.y=Math.abs(t.value.y);if(void 0!==this.parent){const t=this.parent.getMaxScaleFactor();this.maxScale.x*=t.x,this.maxScale.y*=t.y}return this.maxScale}}const P=.005,R=t=>({red:t.readUint8(),green:t.readUint8(),blue:t.readUint8()}),A=t=>t.readEncodedUint64(),C=t=>{const e=t.readFloat32(),i=t.readFloat32();return new b(e,i)},V=(t,e)=>{e.width=t.readEncodeInt32(),e.height=t.readEncodeInt32(),e.duration=A(t),e.frameRate=t.readFloat32(),e.backgroundColor=R(t)};class k{constructor(){this.tagLevel=0,this.compositions=[],this.errorMessages=[]}throwException(t){this.errorMessages.push(t)}releaseCompositions(){const t=this.compositions.slice();return this.compositions=[],t}}const _="PAG file decode error!";class L{constructor(t,e){this._position=0,this.bitPosition=0,this.dataView=new DataView(t),this.littleEndian=!!e,this.context=new k}get length(){return this.dataView.byteLength}get bytesAvailable(){return this.dataView.byteLength-this._position}data(){return this.dataView.buffer}get position(){return this._position}alignWithBytes(){this.bitPosition=8*this._position}readBoolean(){const t=this.dataView.getInt8(this._position);return this._position+=1,this.positonChanged(),Boolean(t)}readChar(){if(this._position>=this.length)throw new Error(_);const t=this.dataView.getInt8(this._position);return this._position+=1,this.positonChanged(),String.fromCharCode(t)}readUint8(){if(this._position>=this.length)throw new Error(_);const t=this.dataView.getUint8(this._position);return this._position+=1,this.positonChanged(),t}readInt8(){if(this._position>=this.length)throw new Error(_);const t=this.dataView.getInt8(this._position);return this._position+=1,this.positonChanged(),t}readInt16(){if(this._position>=this.length-1)throw new Error(_);const t=this.dataView.getInt16(this._position,this.littleEndian);return this._position+=2,this.positonChanged(),t}readUint16(){if(this._position>=this.length-1)throw new Error(_);const t=this.dataView.getUint16(this._position,this.littleEndian);return this._position+=2,this.positonChanged(),t}readInt24(){if(this._position>=this.length-2)throw new Error(_);const t=this.dataView.getInt16(this._position,this.littleEndian),e=this.dataView.getInt8(this._position+2);return this._position+=3,this.positonChanged(),this.littleEndian?t+65536*e:65536*t+e}readUint24(){if(this._position>=this.length-2)throw new Error(_);const t=this.dataView.getUint16(this._position,this.littleEndian),e=this.dataView.getUint8(this._position+2);return this._position+=3,this.positonChanged(),this.littleEndian?t+65536*e:65536*t+e}readInt32(){if(this._position>=this.length-3)throw new Error(_);const t=this.dataView.getInt32(this._position,this.littleEndian);return this._position+=4,this.positonChanged(),t}readUint32(){if(this._position>=this.length-3)throw new Error(_);const t=this.dataView.getUint32(this._position,this.littleEndian);return this._position+=4,this.positonChanged(),t}readInt64(){if(this._position>=this.length-7)throw new Error(_);const t=this.dataView.getInt32(this._position,this.littleEndian),e=this.dataView.getInt32(this._position+4,this.littleEndian);return this._position+=8,this.positonChanged(),this.littleEndian?t+2**32*e:2**32*t+e}readUint64(){if(this._position>=this.length-7)throw new Error(_);const t=this.dataView.getUint32(this._position,this.littleEndian),e=this.dataView.getUint32(this._position+4,this.littleEndian);return this._position+=8,this.positonChanged(),this.littleEndian?t+2**32*e:2**32*t+e}readFloat32(){if(this._position>=this.length-3)throw new Error(_);const t=this.dataView.getFloat32(this._position,this.littleEndian);return this._position+=4,this.positonChanged(),t}readDouble(){if(this._position>=this.length-7)throw new Error(_);const t=this.dataView.getFloat64(this._position,this.littleEndian);return this._position+=8,this.positonChanged(),t}readUTF8String(){if(this._position>=this.length)throw new Error(_);let t="",e=0;for(let i=this._position;i<this.length&&0!==this.dataView.getUint8(i);i++)t+=`%${this.dataView.getUint8(i).toString(16)}`,e+=1;return this._position+=e,this.positonChanged(),decodeURIComponent(t)}readEncodedUint32(){let t=0,e=0;for(let i=0;i<32;i+=7){if(this._position>=this.length)throw Error("readEncodedUint32 End of file was encountered.");if(e=this.dataView.getUint8(this._position),this._position+=1,t|=(127&e)<<i,0==(128&e))break}return this.positonChanged(),t}readEncodeInt32(){const t=this.readEncodedUint32(),e=t>>1;return(1&t)>0?-e:e}readEncodedUint64(){let t=0,e=0;for(let i=0;i<64;i+=7){if(this._position>=this.length)throw Error("readEncodedUint64 End of file was encountered.");if(e=this.dataView.getUint8(this._position),this._position+=1,t|=(127&e)<<i,0==(128&e))break}return this.positonChanged(),t}readEncodeInt64(){const t=this.readEncodedUint64(),e=t<<0;return(1&t)>0?-e:e}readBytes(t){const e=t||this.length-this._position;if(this._position>this.length-e)throw new Error(_);const i=this.dataView.buffer.slice(this._position,this._position+e);return this._position+=e,this.positonChanged(),new L(i,this.littleEndian)}readUBits(t){const e=[0,1,3,7,15,31,63,127,255];let i=0;if(this.bitPosition>8*this.length-t)throw new Error(_);let r=0;for(;r<t;){const n=Math.floor(.125*this.bitPosition),s=this.bitPosition%8;let o=this.dataView.getUint8(n)>>s;const a=Math.min(8-s,t-r);o&=e[a],i|=o<<r,r+=a,this.bitPosition+=a}return this.bitPositionChanged(),i}readBits(t){let e=this.readUBits(t);e<<=32-t;return e<<0>>32-t}readNumBits(){return this.readUBits(5)+1}readInt32List(t){const e=this.readNumBits(),i=new Array(t);for(let r=0;r<t;r++)i[r]=this.readBits(e);return i}readUint32List(t){const e=this.readNumBits(),i=new Array(t);for(let r=0;r<t;r++)i[r]=this.readUBits(e);return i}readBitBoolean(){return 0!==this.readUBits(1)}readFloatList(t,e){const i=this.readNumBits(),r=new Array(t);for(let n=0;n<t;n++)r[n]=this.readBits(i)*e;return r}bitPositionChanged(){this._position=Math.ceil(.125*this.bitPosition)}positonChanged(){this.bitPosition=8*this._position}}class B{constructor(t,e){this.length=0,this.data=t,this.length=e}}class F{constructor(){this.isKeyframe=!1,this.frame=0,this.fileBytes=new B(new L(new ArrayBuffer(0)),0)}}class U{constructor(){this.composition=void 0,this.id=0,this.width=0,this.height=0,this.frameRate=0,this.frameCount=0,this.isKeyFrameFlags=[]}verify(){return p(void 0!==this.composition&&this.width>0&&this.height>0&&this.frameRate>0)}}class D extends U{constructor(){super(...arguments),this.alphaStartX=0,this.alphaStartY=0,this.frames=[],this.headers=[],this.staticTimeRanges=[]}verify(){if(!super.verify()||this.frames.length<=0)return f(),!1;for(const t of this.frames)if(!t||!t.fileBytes)return f(),!1;for(const t of this.headers)if(!t)return f(),!1;return!0}getVideoWidth(){let t=this.alphaStartX+this.width;return t%2==1&&(t+=1),t}getVideoHeight(){let t=this.alphaStartY+this.height;return t%2==1&&(t+=1),t}}const M=t=>{const e=t.readEncodedUint32(),i=t.readBytes(e);if(0===e)throw new Error("Read start code with length 0!");const r=new ArrayBuffer(e+4);return new DataView(r).setUint32(0,e),((t,e,i,r,n)=>{if(e>=t.byteLength||r>=i.byteLength||i.byteLength-r>t.byteLength-e||n>i.byteLength)return;const s=new Uint8Array(t),o=new Uint8Array(i,r,n);s.set(o,e)})(r,4,i.data(),0,e),new B(new L(r),e+4)},I=(t,e,i)=>{const{composition:r}=i;switch(e){case n.CompositionAttributes:V(t,r);break;case n.VideoSequence:{const e=((t,e)=>{const i=new D;i.width=t.readEncodeInt32(),i.height=t.readEncodeInt32(),i.frameRate=t.readFloat32(),e&&(i.alphaStartX=t.readEncodeInt32(),i.alphaStartY=t.readEncodeInt32());const r=M(t),n=M(t);i.headers.push(r,n),i.frameCount=t.readEncodedUint32();for(let e=0;e<i.frameCount;e++){const e=new F;e.isKeyframe=t.readBitBoolean(),i.frames.push(e)}for(let e=0;e<i.frameCount;e++){const r=i.frames[e];r.frame=A(t),r.fileBytes=M(t)}if(t.bytesAvailable>0){const e=t.readEncodedUint32();for(let r=0;r<e;r++){const e={start:0,end:0};e.start=A(t),e.end=A(t),i.staticTimeRanges.push(e)}}return i})(t,i.hasAlpha);e.composition=r,r.sequences.push(e);break}}};var O=(t=>(t[t.Unknown=0]="Unknown",t[t.Tint=1]="Tint",t[t.Fill=2]="Fill",t[t.Stroke=3]="Stroke",t[t.Tritone=4]="Tritone",t[t.DropShadow=5]="DropShadow",t[t.RadialWipe=6]="RadialWipe",t[t.DisplacementMap=7]="DisplacementMap",t))(O||{});function q(t,e,i){if(i<e)return;for(let r=t.length-1;r>=0;r--){const n=t[r];if(!(n.end<e||n.start>i)){if(n.start<e&&n.end>i){const s={start:i+1,end:n.end};n.end=e-1,s.end>s.start&&t.splice(r+1,0,s),n.end<=n.start&&t.splice(r,1);break}n.start>=e&&n.end<=i?t.splice(r,1):n.start<e?(n.end=e-1,n.end<=n.start&&t.splice(r,1)):(n.start=i+1,n.end<=n.start&&t.splice(r,1))}}}function j(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.start===e||r.end<=e)break;if(r.start<e&&r.end>e){const n={start:e,end:r.end};r.end=e-1,n.end>n.start&&t.splice(i+1,0,n),r.end<=r.start&&t.splice(i,1);break}}}class z extends g{constructor(){super(...arguments),this.layers=[],this.staticTimeRanges=[],this.staticTimeRangeUpdated=!1}type(){return r.Vector}getStaticTimeRanges(){return this.staticTimeRangeUpdated||(this.staticTimeRangeUpdated=!0,this.updateStaticTimeRanges()),this.staticTimeRanges}verify(){if(!super.verify())return f(),!1;for(const t of this.layers)if(!t||!t.verify())return f(),!1;return!0}updateStaticTimeRanges(){if(this.duration>1){const t={start:0,end:this.duration-1};this.staticTimeRanges=[t];for(const t of this.layers){if(this.staticTimeRanges.length<=0)break;t.excludeVaryingRanges(this.staticTimeRanges),j(this.staticTimeRanges,t.startTime),j(this.staticTimeRanges,t.startTime+t.duration)}}}}class N{constructor(t){this.value=t}animatable(){return!1}excludeVaryingRanges(t){}gotoFrame(t){}}class G{static createDefaultTransform2D(){return new G}constructor(){this.anchorPoint=new N(S),this.position=new N(S),this.xPosition=new N(0),this.yPosition=new N(0),this.scale=new N(new b(1,1)),this.rotation=new N(0),this.opacity=new N(255)}excludeVaryingRanges(t){this.anchorPoint.excludeVaryingRanges(t),void 0!==this.position?this.position.excludeVaryingRanges(t):(this.xPosition.excludeVaryingRanges(t),this.yPosition.excludeVaryingRanges(t)),this.scale.excludeVaryingRanges(t),this.rotation.excludeVaryingRanges(t),this.opacity.excludeVaryingRanges(t)}gotoFrame(t){this.anchorPoint.gotoFrame(t),void 0!==this.position?this.position.gotoFrame(t):(this.xPosition.gotoFrame(t),this.yPosition.gotoFrame(t)),this.scale.gotoFrame(t),this.rotation.gotoFrame(t),this.opacity.gotoFrame(t)}verify(){return void 0!==this.anchorPoint&&(void 0!==this.position||void 0!==this.xPosition&&void 0!==this.yPosition)&&void 0!==this.scale&&void 0!==this.rotation&&void 0!==this.opacity}}class W extends T{constructor(){super(...arguments),this.composition=void 0,this.compositionStartTime=0,this.staticTimeRanges=void 0,this.staticTimeRangeUpdated=!1}static wrap(t){const e=new W;e.duration=t.duration;const i=new G;return e.transform=i,e.composition=t,e}type(){return E.PreCompose}excludeVaryingRanges(t){super.excludeVaryingRanges(t),t&&0!==t.length&&this.updateStaticTimeRanges()}gotoFrame(t){super.gotoFrame(t)}verify(){return!!super.verify()&&!!this.composition}updateStaticTimeRanges(){var t;if(this.staticTimeRangeUpdated)return;this.staticTimeRangeUpdated=!0;const e=null==(t=this.composition)?void 0:t.getStaticTimeRanges();if(e){for(let t=e.length-1;t>=0;t--){const i=e[t];i.start+=this.compositionStartTime,i.end+=this.compositionStartTime,i.end<=this.startTime?e.pop():i.start<this.startTime?i.start=0:i.start>=this.startTime+this.duration-1?e.pop():i.end>this.startTime+this.duration-1&&(i.end=this.startTime+this.duration-1)}this.staticTimeRanges=e}}}class H extends T{constructor(){super(...arguments),this.contents=[]}type(){return E.Shape}excludeVaryingRanges(t){super.excludeVaryingRanges(t);for(const e of this.contents)e.excludeVaryingRanges(t)}gotoFrame(t){super.gotoFrame(t);for(const e of this.contents)e.gotoFrame(t)}verify(){if(!super.verify())return!1;for(const t of this.contents)if(void 0===t||!t.verify())return!1;return!0}}class X extends T{constructor(){super(...arguments),this.solidColor=d,this.width=0,this.height=0}type(){return E.Solid}excludeVaryingRanges(t){super.excludeVaryingRanges(t)}gotoFrame(t){super.gotoFrame(t)}verify(){return super.verify()?p(this.width>0&&this.height>0):(f(),!1)}}class K extends T{type(){return E.undefined}}class Y{constructor(){this.startTime=0,this.endTime=0,this.interpolationType=l.Hold,this.bezierOut=[],this.bezierIn=[],this.spatialOut=S,this.spatialIn=S}initialize(){}getValue(t){return this.startValue}containsTime(t){return t>=this.startTime&&t<this.endTime}}class $ extends N{constructor(t){if(!t||0===t.length)throw new Error("keyframes is required");if(void 0===t[0].startValue)throw new Error("startValue is required");super(t[0].startValue),this.keyframes=t,this.lastKeyframeIndex=0;for(const e of t)e.initialize()}animatable(){return!0}excludeVaryingRanges(t){for(const e of this.keyframes)switch(e.interpolationType){case l.Bezier:case l.Linear:q(t,e.startTime,e.endTime-1);break;default:j(t,e.startTime),j(t,e.endTime)}}gotoFrame(t){let e=this.keyframes[this.lastKeyframeIndex];if(e.containsTime(t))this.value=e.getValue(t);else{if(t<e.startTime)for(;this.lastKeyframeIndex>0&&(this.lastKeyframeIndex-=1,!this.keyframes[this.lastKeyframeIndex].containsTime(t)););else for(;this.lastKeyframeIndex<this.keyframes.length-1&&(this.lastKeyframeIndex+=1,!this.keyframes[this.lastKeyframeIndex].containsTime(t)););e=this.keyframes[this.lastKeyframeIndex],void 0!==e.startValue&&t<=e.startTime?this.value=e.startValue:void 0!==e.endValue&&t>=e.endTime?this.value=e.endValue:this.value=e.getValue(t)}}}var J=(t=>(t[t.Value=0]="Value",t[t.FixedValue=1]="FixedValue",t[t.SimpleProperty=2]="SimpleProperty",t[t.DiscreteProperty=3]="DiscreteProperty",t[t.MultiDimensionProperty=4]="MultiDimensionProperty",t[t.SpatialProperty=5]="SpatialProperty",t[t.BitFlag=6]="BitFlag",t[t.Custom=7]="Custom",t))(J||{});const Z=(t,e,i)=>{const r=i,n=[];if(!r.configs||0===r.configs.length)return e;for(const e of r.configs){const i=rt(t,e);n.push(i)}t.alignWithBytes();let s=0;for(const i of r.configs){const r=n[s],o=i.key;i.readAttribute(t,r,e,o),s+=1}return e};class Q{constructor(t,e,i){this.attributeType=e,this.defaultValue=i,this.key=t}readAttribute(t,e,i,r){}readValue(t){}readValueList(t,e,i){}dimensionality(){return 1}newKeyframe(t){return new Y}}const tt=(t,e,i,r,n)=>{6===n.attributeType?i[r]=e.exist:1===n.attributeType?i[r]=n.readValue(t):0===n.attributeType?i[r]=it(t,n,e):i[r]=et(t,n,e)},et=(t,e,i)=>{let r;if(i.exist)if(i.animatable){const n=nt(t,e,i);if(!n||0===n.length)throw new Error("Wrong number of keyframes!");st(t,n,e),ot(t,n,e),i.hasSpatial,r=new $(n)}else r=new N(it(t,e,i));else r=new N(e.defaultValue);return r},it=(t,e,i)=>i.exist?e.readValue(t):e.defaultValue,rt=(t,e)=>{const i={exist:!1,animatable:!1,hasSpatial:!1},{attributeType:r}=e;return 1===r?(i.exist=!0,i):(i.exist=t.readBitBoolean(),i.exist&&0!==r&&6!==r&&7!==r?(i.animatable=t.readBitBoolean(),i.animatable&&5===r?(i.hasSpatial=t.readBitBoolean(),i):i):i)},nt=(t,e,i)=>{const r=[],n=t.readEncodedUint32();for(let s=0;s<n;s++){let n;if(3===e.attributeType)n=new Y;else{const r=t.readUBits(2);r===l.Hold?n=new Y:(n=e.newKeyframe(i),n.interpolationType=r)}r.push(n)}return r},st=(t,e,i)=>{const r=e.length;e[0].startTime=A(t);for(let i=0;i<r;i++){const n=A(t);e[i].endTime=n,i<r-1&&(e[i+1].startTime=n)}const n=[];i.readValueList(t,n,r+1);let s=0;e[0].startValue=n[s],s+=1;for(let t=0;t<r;t++){const i=n[s];s+=1,e[t].endValue=i,t<r-1&&(e[t+1].startValue=i)}},ot=(t,e,i)=>{const r=4===i.attributeType?i.dimensionality():1,n=t.readNumBits();for(const i of e){if(i.interpolationType!==l.Bezier)continue;let e,s;for(let o=0;o<r;o++)e=t.readBits(n)*P,s=t.readBits(n)*P,i.bezierOut.push({x:e,y:s}),e=t.readBits(n)*P,s=t.readBits(n)*P,i.bezierIn.push({x:e,y:s})}};function at(t,e,i){return t+(e-t)*i}class ht{getInterpolation(t){return t}}class lt extends Y{initialize(){super.initialize(),this.interpolationType===l.Bezier||(this.xInterpolator=new ht,this.yInterpolator=new ht)}getValue(t){var e,i,r,n;const s=(t-this.startTime)/(this.endTime-this.startTime),o=null!=(i=null==(e=this.xInterpolator)?void 0:e.getInterpolation(s))?i:s,a=null!=(n=null==(r=this.yInterpolator)?void 0:r.getInterpolation(s))?n:s;return{x:at(this.startValue.x,this.endValue.x,o),y:at(this.startValue.y,this.endValue.y,a)}}}class ct extends Y{initialize(){this.interpolationType===l.Bezier||(this.interpolator=new ht)}getProgress(t){var e,i;const r=(t-this.startTime)/(this.endTime-this.startTime);return null!=(i=null==(e=this.interpolator)?void 0:e.getInterpolation(r))?i:r}getValue(t){const e=this.getProgress(t);return at(this.startValue,this.endValue,e)}}class dt extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return t.readFloat32()}readValueList(t,e,i){for(let r=0;r<i;r++)e.push(this.readValue(t))}dimensionality(){return 1}newKeyframe(t){return new ct}}class ut extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return t.readBoolean()}readValueList(t,e,i){for(let r=0;r<i;r++)e.push(t.readBitBoolean())}dimensionality(){return 1}newKeyframe(t){return new Y}}class ft extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return t.readUint8()}readValueList(t,e,i){const r=t.readUint32List(i);for(let t=0;t<i;t++)e.push(r[t])}dimensionality(){return 1}newKeyframe(t){return new ct}}class pt extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return A(t)}readValueList(t,e,i){for(let r=0;r<i;r++)e[r]=this.readValue(t)}dimensionality(){return 1}newKeyframe(t){return new ct}}class mt extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return C(t)}readValueList(t,e,i){if(this.attributeType===J.SpatialProperty){const r=t.readFloatList(2*i,.05);for(let t=0;t<i;t++)e[t]||(e[t]=new b(0,0)),e[t].x=r[t]}else for(let r=0;r<i;r++)e[r]=C(t)}dimensionality(){return 2}newKeyframe(t){return this.attributeType===J.MultiDimensionProperty?new lt:new ct}}class gt extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return(t=>{const e=t.readEncodeInt32(),i=t.readEncodedUint32();return new v(e,i)})(t)}readValueList(t,e,i){for(let r=0;r<i;r++)e[r]=this.readValue(t)}dimensionality(){return 1}newKeyframe(t){return new ct}}class yt extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return(t=>{const e=t.readEncodedUint32();if(0===e)throw new Error("Layer ID is 0");const i=new T;return i.id=e,i})(t)}readValueList(t,e,i){for(let r=0;r<i;r++)e[r]=this.readValue(t)}dimensionality(){return 1}newKeyframe(t){return new ct}}const vt={tagCode:n.LayerAttributes,configs:[new ut("isActive",J.BitFlag,!0),new ut("autoOrientation",J.BitFlag,!1),new yt("parent",J.Value,void 0),new gt("stretch",J.Value,w),new pt("startTime",J.Value,0),new ft("blendMode",J.Value,h.Normal),new ft("trackMatteType",J.Value,x.None),new dt("timeRemap",J.SimpleProperty,0),new pt("duration",J.FixedValue,0)]},wt={tagCode:n.LayerAttributesV2,configs:[new ut("isActive",J.BitFlag,!0),new ut("autoOrientation",J.BitFlag,!1),new yt("parent",J.Value,void 0),new gt("stretch",J.Value,w),new pt("startTime",J.Value,0),new ft("blendMode",J.Value,h.Normal),new ft("trackMatteType",J.Value,x.None),new dt("timeRemap",J.SimpleProperty,0),new pt("duration",J.FixedValue,0),new class extends Q{constructor(t,e,i){super(t,e,i)}readAttribute(t,e,i,r){tt(t,e,i,r,this)}readValue(t){return t.readUTF8String()}readValueList(t,e,i){for(let r=0;r<i;r++)e[r]=this.readValue(t)}dimensionality(){return 1}newKeyframe(t){return new ct}}("name",J.Value,"")]},bt={tagCode:n.Transform2D,configs:[new mt("anchorPoint",J.SpatialProperty,S),new mt("position",J.SpatialProperty,S),new dt("xPosition",J.SimpleProperty,0),new dt("yPosition",J.SimpleProperty,0),new mt("scale",J.MultiDimensionProperty,new b(1,1)),new dt("rotation",J.SimpleProperty,0),new ft("opacity",J.SimpleProperty,255)]};n.MaskBlock;const St=(t,e,i)=>{switch(e){case n.LayerAttributes:Z(t,i,vt),i.duration<=0&&(i.duration=1);break;case n.LayerAttributesV2:Z(t,i,wt),i.duration<=0&&(i.duration=1);break;case n.Transform2D:i.transform=new G,Z(t,i.transform,bt),i.transform.position.animatable()||i.transform.position.value!==S||!i.transform.xPosition.animatable()&&0===i.transform.xPosition.value&&!i.transform.yPosition.animatable()&&0===i.transform.yPosition.value?(i.transform.xPosition=new N(0),i.transform.yPosition=new N(0)):i.transform.position=new N(S);break;case n.SolidColor:i.type()===E.Solid&&function(t,e){e.solidColor=R(t),e.width=t.readEncodeInt32(),e.height=t.readEncodeInt32()}(t,i);break;case n.CompositionReference:i.type()===E.PreCompose&&function(t,e){const i=t.readEncodedUint32();i>0&&(e.composition=new g,e.composition.id=i),e.compositionStartTime=A(t)}(t,i)}},xt=(t,e,i)=>{switch(e){case n.CompositionAttributes:V(t,i);break;case n.LayerBlock:i.layers.push((t=>{let e;switch(t.readUint8()){case E.undefined:e=new K;break;case E.Solid:e=new X;break;case E.Shape:e=new H;break;case E.PreCompose:e=new W;break;default:e=new T}return e.id=t.readEncodedUint32(),o(t,e,St),e})(t))}},Et=t=>{if(t&&0===t.length)return;const e=new Map;for(const i of t)i&&(Tt(i),e.set(i.id,i));let i=0;for(const r of t)if(r){if(void 0!==r.parent){const t=r.parent.id,i=e.get(t);void 0!==i&&(r.parent=i)}if(i>0&&Pt(r.trackMatteType)&&(r.trackMatteLayer=t[i-1]),void 0!==r.effects&&r.effects.length>0)for(const t of r.effects)t&&(t.type(),O.DisplacementMap);i+=1}},Tt=t=>{var e;if(!t||!t.masks||0===t.masks.length)return;const i=new Map;for(const e of t.masks)e&&i.set(e.id,e);if(null==(e=t.effects)||e.forEach((t=>{if(t){if(void 0!==t.maskReferences&&t.maskReferences.length>0){const e=new Array;t.maskReferences.forEach((t=>{const r=t.id,n=i.get(r);void 0!==n&&e.push(n)})),t.maskReferences=e}switch(t.type()){case O.Fill:if(void 0!==t.fillMask){const e=t.fillMask.id,r=i.get(e);void 0!==r&&(t.fillMask=r)}break;case O.Stroke:{const e=t;if(void 0!==e.path){const t=e.path.id,r=i.get(t);void 0!==r&&(e.path=r)}break}}}})),t.type()===E.Text){const{pathOption:e}=t;if(null==e?void 0:e.path){const t=e.path.id,r=i.get(t);void 0!==r&&(e.path=r)}}},Pt=t=>{switch(t){case x.Alpha:case x.AlphaInverted:return!0;default:return!1}};function Rt(t,e,i){switch(e){case n.VectorCompositionBlock:i.compositions.push((t=>{const e=new z;return e.id=t.readEncodedUint32(),o(t,e,xt),Et(e.layers),e})(t));break;case n.VideoCompositionBlock:i.compositions.push((t=>{const e=new y;return e.id=t.readEncodedUint32(),e.hasAlpha=t.readBoolean(),o(t,{composition:e,hasAlpha:e.hasAlpha},I),e})(t))}}const At=t=>{const e=Ct(t),{context:i}=e;o(e,i,Rt),function(t){if(!t||0===t.length)return;const e=new Map;t.forEach((t=>{t&&e.set(t.id,t)})),t.forEach((t=>{if(t&&t.type()===r.Vector){const i=t;i.layers&&i.layers.length>0&&i.layers.forEach((t=>{t.containingComposition=i;const r=t;if(r.type()===E.PreCompose&&r.composition){const t=e.get(r.composition.id);t&&(r.composition=t)}}))}}))}(i.compositions);const n=i.releaseCompositions();return(t=>{let e=t.length>0;for(const i of t)if(!i||!i.verify()){e=!1;break}if(!e)throw new Error("Verify composition failed!")})(n),{compositions:n,tagLevel:i.tagLevel}},Ct=t=>{if(t.length<11)throw new Error("PAG file is invalid!");const e=t.readInt8(),i=t.readInt8(),r=t.readInt8();if(80!==e||65!==i||71!==r)throw new Error("invalid PAG header!");return t.readInt8(),t.readUint32(),t.readInt8(),t.readBytes()};class Vt{constructor(t,e){this.tagLevel=1,this.compositions=[],this.numLayers=0,this.scaledTimeRange={start:0,end:0},this.mainComposition=t[t.length-1],this.scaledTimeRange.start=0,this.scaledTimeRange.end=this.mainComposition.duration,this.compositions=t,this.duration=this.mainComposition.duration,this.implDuration=1e3*this.mainComposition.duration/this.mainComposition.frameRate;for(const e of t)if(e.type()===r.Vector)for(const t of e.layers)t.type()!==E.PreCompose&&(this.numLayers+=1);else this.numLayers+=1;this.tagLevel=e}static fromArrayBuffer(t){if(!t||0===t.byteLength)throw new Error("Can't read empty array buffer!");const e=new L(t,!0),{compositions:i,tagLevel:r}=At(e);return new Vt(i,r)}getVideoSequence(){const t=this.mainComposition.type();return t===r.Video?kt(this.mainComposition):t===r.Vector?_t(this.mainComposition):void 0}}const kt=t=>{if(!t.sequences||0===t.sequences.length)throw new Error("PAGFile has no BMP video sequence!");return t.sequences[t.sequences.length-1]},_t=t=>{const e=Lt(t);if(e.length>1)throw new Error("PAGFile has more than one BMP video sequence!");if(e.length<1)throw new Error("PAGFile has no BMP video sequence!");const i=e[0];return kt(i)},Lt=t=>{const e=[];return t.layers.forEach((t=>{if(t.type()!==E.PreCompose)return;const{composition:i}=t;(null==i?void 0:i.type())!==r.Video?(null==i?void 0:i.type())===r.Vector&&e.push(...Lt(i)):e.push(i)})),e};var Bt=(t=>(t.Canvas2D="2d",t.WebGL="WebGL",t))(Bt||{}),Ft=(t=>(t.onAnimationStart="onAnimationStart",t.onAnimationEnd="onAnimationEnd",t.onAnimationCancel="onAnimationCancel",t.onAnimationRepeat="onAnimationRepeat",t.onAnimationUpdate="onAnimationUpdate",t.onAnimationPlay="onAnimationPlay",t.onAnimationPause="onAnimationPause",t))(Ft||{}),Ut=(t=>(t.None="None",t.Stretch="Stretch",t.LetterBox="LetterBox",t.Zoom="Zoom",t))(Ut||{}),Dt=Object.freeze({__proto__:null,RenderingMode:Bt,EventName:Ft,ScaleMode:Ut});function Mt(t){let e=Object.getOwnPropertyNames(t.prototype).filter((e=>"constructor"!==e&&"function"==typeof t.prototype[e]));const i=(t,e)=>{const i=t[e];t[e]=function(){if(!this.destroyed){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return i.call(this,...r)}console.error(`Don't call ${e} of the PAGView that is destroyed.`)}};e.forEach((e=>i(t.prototype,e)))}const It=(t,e,i)=>{const r=t.createProgram();if(!r)throw new Error("Failed to create program.");const n=Ot(t,e,t.VERTEX_SHADER);if(!n)throw new Error("Failed to create vertex shader.");t.attachShader(r,n);const s=Ot(t,i,t.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader.");t.attachShader(r,s),t.linkProgram(r);const o=t.getProgramInfoLog(r);o&&console.log(o);const a=t.getShaderInfoLog(n);a&&console.log(a);const h=t.getShaderInfoLog(s);return h&&console.log(h),r},Ot=(t,e,i)=>{const r=t.createShader(i);if(!r)throw new Error("Failed to create shader.");return t.shaderSource(r,e),t.compileShader(r),r},qt=t=>t.replace(/^\s+|\s+$/g,""),jt=t=>{const e=t.createTexture();if(!e)throw new Error("Failed to create texture.");return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),e};class zt{constructor(){this.listenersMap={}}on(t,e){void 0===this.listenersMap[t]&&(this.listenersMap[t]=[]),this.listenersMap[t].push(e)}off(t,e){const i=this.listenersMap[t];if(void 0===i)return;if(void 0===e)return void delete this.listenersMap[t];const r=i.findIndex((t=>t===e));i.splice(r,1)}emit(t){const e=this.listenersMap[t];if(void 0===e||e.length<1)return!1;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(const t of e)t(...r);return!0}}var Nt=Object.defineProperty,Gt=Object.getOwnPropertyDescriptor,Wt=Object.getOwnPropertySymbols,Ht=Object.prototype.hasOwnProperty,Xt=Object.prototype.propertyIsEnumerable,Kt=(t,e,i)=>e in t?Nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Yt=(t,e)=>{for(var i in e||(e={}))Ht.call(e,i)&&Kt(t,i,e[i]);if(Wt)for(var i of Wt(e))Xt.call(e,i)&&Kt(t,i,e[i]);return t};let $t=class{constructor(t,e,i){this.canvasSize={width:0,height:0},this.playing=!1,this.viewportSize={x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},this.destroyed=!1,this.renderTimer=null,this.repeatCount=0,this.viewScaleMode=Ut.LetterBox,this.debugData={FPS:0,decodePAGFile:0,createDir:0,coverMP4:0,writeFile:0,createDecoder:0,getFrame:0,draw:0};const r=t.getVideoSequence();if(!r)throw new Error("PAGFile has no BMP video sequence!");delete r.composition,this.videoSequence=r,this.canvas=e,this.videoParam=((t,e)=>({width:t.mainComposition.width,height:t.mainComposition.height,hasAlpha:e.alphaStartX>0||e.alphaStartY>0,alphaStartX:e.alphaStartX,alphaStartY:e.alphaStartY,sequenceWidth:e.width,sequenceHeight:e.height,MP4Width:(e.width+e.alphaStartX)%2==0?e.width+e.alphaStartX:e.width+e.alphaStartX+1,MP4Height:(e.height+e.alphaStartY)%2==0?e.height+e.alphaStartY:e.height+e.alphaStartY+1}))(t,r),this.eventManager=new zt,this.renderingMode=i.renderingMode||Bt.WebGL,this.updateSize(i.useScale),this.setScaleMode()}isPlaying(){return this.playing}isDestroyed(){return this.destroyed}duration(){return this.videoSequence.frameCount/this.videoSequence.frameRate}frameRate(){return this.videoSequence.frameRate}setRepeatCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.repeatCount=t<0?-1:t-1}addListener(t,e){return this.eventManager.on(t,e)}removeListener(t,e){return this.eventManager.off(t,e)}scaleMode(){return this.viewScaleMode}setScaleMode(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut.LetterBox;switch(this.viewScaleMode=t,t){case Ut.None:this.viewportSize={x:0,y:this.renderingMode===Bt.WebGL?this.canvas.height-this.videoParam.height:0,width:this.videoParam.width,height:this.videoParam.height,scaleX:1,scaleY:1};break;case Ut.Stretch:this.viewportSize={x:0,y:0,width:this.canvas.width,height:this.canvas.height,scaleX:this.canvas.width/this.videoParam.sequenceWidth,scaleY:this.canvas.height/this.videoParam.sequenceHeight};break;case Ut.LetterBox:{const t=this.canvas.width/this.videoParam.sequenceWidth,e=this.canvas.height/this.videoParam.sequenceHeight,i=Math.min(t,e);this.viewportSize={x:(this.canvas.width-this.videoParam.sequenceWidth*i)/2,y:(this.canvas.height-this.videoParam.sequenceHeight*i)/2,width:this.videoParam.sequenceWidth*i,height:this.videoParam.sequenceHeight*i,scaleX:i,scaleY:i}}break;case Ut.Zoom:{const t=this.canvas.width/this.videoParam.sequenceWidth,e=this.canvas.height/this.videoParam.sequenceHeight,i=Math.max(t,e);this.viewportSize={x:(this.canvas.width-this.videoParam.sequenceWidth*i)/2,y:(this.canvas.height-this.videoParam.sequenceHeight*i)/2,width:this.videoParam.sequenceWidth*i,height:this.videoParam.sequenceHeight*i,scaleX:i,scaleY:i}}}}updateSize(){let t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.canvas)throw new Error("Canvas element is not found!");const i=getComputedStyle(this.canvas),r={width:Number(i.width.replace("px","")),height:Number(i.height.replace("px",""))};if(r.width>0&&r.height>0)t=r;else{const e={width:Number(this.canvas.style.width.replace("px","")),height:Number(this.canvas.style.height.replace("px",""))};t=e.width>0&&e.height>0?e:{width:this.canvas.width,height:this.canvas.height}}if(!e)return this.canvas.width=this.canvas.width||t.width,void(this.canvas.height=this.canvas.height||t.height);this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`,console.log("aaa displaySize.width: "+JSON.stringify(t.width)),console.log("aaa displaySize.height: "+JSON.stringify(t.height)),console.log("aaa window.devicePixelRatio: "+JSON.stringify(window.devicePixelRatio)),this.canvas.width=t.width*window.devicePixelRatio,this.canvas.height=t.height*window.devicePixelRatio,console.log("aaa this.canvas.width: "+JSON.stringify(this.canvas.width)),console.log("aaa this.canvas.height: "+JSON.stringify(this.canvas.height))}getDebugData(){return this.debugData}setDebugData(t){this.debugData=Yt(Yt({},this.debugData),t)}loadContext(){}clearRender(){}};$t=((t,e,i,r)=>{for(var n,s=r>1?void 0:r?Gt(e,i):e,o=t.length-1;o>=0;o--)(n=t[o])&&(s=(r?n(e,i,s):n(s))||s);return r&&s&&Nt(e,i,s),s})([Mt],$t);var Jt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Zt=function(t){return t&&t.Math==Math&&t},Qt=Zt("object"==typeof globalThis&&globalThis)||Zt("object"==typeof window&&window)||Zt("object"==typeof self&&self)||Zt("object"==typeof Jt&&Jt)||function(){return this}()||Function("return this")(),te=function(t){try{return!!t()}catch(t){return!0}},ee=!te((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),ie={exports:{}},re=!te((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),ne=re,se=Function.prototype,oe=se.call,ae=ne&&se.bind.bind(oe,oe),he=ne?ae:function(t){return function(){return oe.apply(t,arguments)}},le="object"==typeof document&&document.all,ce={all:le,IS_HTMLDDA:void 0===le&&void 0!==le},de=ce.all,ue=ce.IS_HTMLDDA?function(t){return"function"==typeof t||t===de}:function(t){return"function"==typeof t},fe=function(t){return null==t},pe=fe,me=TypeError,ge=function(t){if(pe(t))throw me("Can't call method on "+t);return t},ye=Object,ve=function(t){return ye(ge(t))},we=he({}.hasOwnProperty),be=Object.hasOwn||function(t,e){return we(ve(t),e)},Se=ee,xe=be,Ee=Function.prototype,Te=Se&&Object.getOwnPropertyDescriptor,Pe=xe(Ee,"name"),Re={EXISTS:Pe,PROPER:Pe&&"something"===function(){}.name,CONFIGURABLE:Pe&&(!Se||Se&&Te(Ee,"name").configurable)},Ae=Qt,Ce=Object.defineProperty,Ve=function(t,e){try{Ce(Ae,t,{value:e,configurable:!0,writable:!0})}catch(i){Ae[t]=e}return e},ke="__core-js_shared__",_e=Qt[ke]||Ve(ke,{}),Le=ue,Be=_e,Fe=he(Function.toString);Le(Be.inspectSource)||(Be.inspectSource=function(t){return Fe(t)});var Ue,De,Me=Be.inspectSource,Ie=ue,Oe=Qt.WeakMap,qe=Ie(Oe)&&/native code/.test(String(Oe)),je=ue,ze=ce.all,Ne=ce.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:je(t)||t===ze}:function(t){return"object"==typeof t?null!==t:je(t)},Ge={},We=Ne,He=Qt.document,Xe=We(He)&&We(He.createElement),Ke=function(t){return Xe?He.createElement(t):{}},Ye=!ee&&!te((function(){return 7!=Object.defineProperty(Ke("div"),"a",{get:function(){return 7}}).a})),$e=ee&&te((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Je=Ne,Ze=String,Qe=TypeError,ti=function(t){if(Je(t))return t;throw Qe(Ze(t)+" is not an object")},ei=re,ii=Function.prototype.call,ri=ei?ii.bind(ii):function(){return ii.apply(ii,arguments)},ni=Qt,si=ue,oi=he({}.isPrototypeOf),ai=Qt,hi="undefined"!=typeof navigator&&String(navigator.userAgent)||"",li=ai.process,ci=ai.Deno,di=li&&li.versions||ci&&ci.version,ui=di&&di.v8;ui&&(De=(Ue=ui.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!De&&hi&&(!(Ue=hi.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=hi.match(/Chrome\/(\d+)/))&&(De=+Ue[1]);var fi=De,pi=te,mi=!!Object.getOwnPropertySymbols&&!pi((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&fi&&fi<41})),gi=mi&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,yi=function(t,e){return arguments.length<2?(i=ni[t],si(i)?i:void 0):ni[t]&&ni[t][e];var i},vi=ue,wi=oi,bi=Object,Si=gi?function(t){return"symbol"==typeof t}:function(t){var e=yi("Symbol");return vi(e)&&wi(e.prototype,bi(t))},xi=String,Ei=ue,Ti=function(t){try{return xi(t)}catch(t){return"Object"}},Pi=TypeError,Ri=function(t){if(Ei(t))return t;throw Pi(Ti(t)+" is not a function")},Ai=fe,Ci=ri,Vi=ue,ki=Ne,_i=TypeError,Li={exports:{}},Bi=_e;(Li.exports=function(t,e){return Bi[t]||(Bi[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.1",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Fi=he,Ui=0,Di=Math.random(),Mi=Fi(1..toString),Ii=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Mi(++Ui+Di,36)},Oi=Qt,qi=Li.exports,ji=be,zi=Ii,Ni=mi,Gi=gi,Wi=Oi.Symbol,Hi=qi("wks"),Xi=Gi?Wi.for||Wi:Wi&&Wi.withoutSetter||zi,Ki=ri,Yi=Ne,$i=Si,Ji=function(t,e){var i=t[e];return Ai(i)?void 0:Ri(i)},Zi=function(t,e){var i,r;if("string"===e&&Vi(i=t.toString)&&!ki(r=Ci(i,t)))return r;if(Vi(i=t.valueOf)&&!ki(r=Ci(i,t)))return r;if("string"!==e&&Vi(i=t.toString)&&!ki(r=Ci(i,t)))return r;throw _i("Can't convert object to primitive value")},Qi=TypeError,tr=function(t){return ji(Hi,t)||(Hi[t]=Ni&&ji(Wi,t)?Wi[t]:Xi("Symbol."+t)),Hi[t]}("toPrimitive"),er=function(t,e){if(!Yi(t)||$i(t))return t;var i,r=Ji(t,tr);if(r){if(void 0===e&&(e="default"),i=Ki(r,t,e),!Yi(i)||$i(i))return i;throw Qi("Can't convert object to primitive value")}return void 0===e&&(e="number"),Zi(t,e)},ir=Si,rr=ee,nr=Ye,sr=$e,or=ti,ar=function(t){var e=er(t,"string");return ir(e)?e:e+""},hr=TypeError,lr=Object.defineProperty,cr=Object.getOwnPropertyDescriptor,dr="enumerable",ur="configurable",fr="writable";Ge.f=rr?sr?function(t,e,i){if(or(t),e=ar(e),or(i),"function"==typeof t&&"prototype"===e&&"value"in i&&fr in i&&!i[fr]){var r=cr(t,e);r&&r[fr]&&(t[e]=i.value,i={configurable:ur in i?i[ur]:r[ur],enumerable:dr in i?i[dr]:r[dr],writable:!1})}return lr(t,e,i)}:lr:function(t,e,i){if(or(t),e=ar(e),or(i),nr)try{return lr(t,e,i)}catch(t){}if("get"in i||"set"in i)throw hr("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var pr,mr,gr,yr=Ge,vr=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},wr=ee?function(t,e,i){return yr.f(t,e,vr(1,i))}:function(t,e,i){return t[e]=i,t},br=Li.exports,Sr=Ii,xr=br("keys"),Er=qe,Tr=Qt,Pr=Ne,Rr=wr,Ar=be,Cr=_e,Vr=function(t){return xr[t]||(xr[t]=Sr(t))},kr="Object already initialized",_r=Tr.TypeError,Lr=Tr.WeakMap;if(Er||Cr.state){var Br=Cr.state||(Cr.state=new Lr);Br.get=Br.get,Br.has=Br.has,Br.set=Br.set,pr=function(t,e){if(Br.has(t))throw _r(kr);return e.facade=t,Br.set(t,e),e},mr=function(t){return Br.get(t)||{}},gr=function(t){return Br.has(t)}}else{var Fr=Vr("state");pr=function(t,e){if(Ar(t,Fr))throw _r(kr);return e.facade=t,Rr(t,Fr,e),e},mr=function(t){return Ar(t,Fr)?t[Fr]:{}},gr=function(t){return Ar(t,Fr)}}var Ur={set:pr,get:mr,has:gr,enforce:function(t){return gr(t)?mr(t):pr(t,{})},getterFor:function(t){return function(e){var i;if(!Pr(e)||(i=mr(e)).type!==t)throw _r("Incompatible receiver, "+t+" required");return i}}},Dr=he,Mr=te,Ir=ue,Or=be,qr=ee,jr=Re.CONFIGURABLE,zr=Me,Nr=Ur.enforce,Gr=Ur.get,Wr=String,Hr=Object.defineProperty,Xr=Dr("".slice),Kr=Dr("".replace),Yr=Dr([].join),$r=qr&&!Mr((function(){return 8!==Hr((function(){}),"length",{value:8}).length})),Jr=String(String).split("String"),Zr=ie.exports=function(t,e,i){"Symbol("===Xr(Wr(e),0,7)&&(e="["+Kr(Wr(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!Or(t,"name")||jr&&t.name!==e)&&(qr?Hr(t,"name",{value:e,configurable:!0}):t.name=e),$r&&i&&Or(i,"arity")&&t.length!==i.arity&&Hr(t,"length",{value:i.arity});try{i&&Or(i,"constructor")&&i.constructor?qr&&Hr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=Nr(t);return Or(r,"source")||(r.source=Yr(Jr,"string"==typeof e?e:"")),t};Function.prototype.toString=Zr((function(){return Ir(this)&&Gr(this).source||zr(this)}),"toString");var Qr=ie.exports,tn=Ge,en=ti,rn=ee,nn=function(t,e,i){return i.get&&Qr(i.get,e,{getter:!0}),i.set&&Qr(i.set,e,{setter:!0}),tn.f(t,e,i)},sn=function(){var t=en(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},on=te,an=Qt.RegExp,hn=an.prototype;rn&&on((function(){var t=!0;try{an(".","d")}catch(e){t=!1}var e={},i="",r=t?"dgimsy":"gimsy",n=function(t,r){Object.defineProperty(e,t,{get:function(){return i+=r,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in t&&(s.hasIndices="d"),s)n(o,s[o]);return Object.getOwnPropertyDescriptor(hn,"flags").get.call(e)!==r||i!==r}))&&nn(hn,"flags",{configurable:!0,get:sn});const ln=2082873600,cn=t=>{const e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e},dn=t=>[t>>24,t>>16&255,t>>8&255,255&t],un=function(t){let e=8;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];let s=r.length;const o=s;for(;s;)s-=1,e+=r[s].byteLength;const a=new Uint8Array(e);for(a[0]=e>>24&255,a[1]=e>>16&255,a[2]=e>>8&255,a[3]=255&e,a.set(t,4),s=0,e=8;s<o;++s)a.set(r[s],e),e+=r[s].byteLength;return a};class fn{constructor(t){this.param=t}ftyp(){return un(cn("ftyp"),new Uint8Array(cn("isom")),new Uint8Array([0,0,0,1]),new Uint8Array(cn("isom")),new Uint8Array(cn("iso2")),new Uint8Array(cn("avc1")),new Uint8Array(cn("mp41")))}moov(){const t=this.param.tracks.map((t=>this.trak(t))).reverse();return un(cn("moov"),this.mvhd(),...t,this.mvex())}moof(){return un(cn("moof"),this.mfhd(),this.traf())}mdat(){const t=new Uint8Array(this.param.track.len);let e=0;return this.param.videoSequence.headers.forEach((i=>{t.set(new Uint8Array(i.data.data()),e),e+=i.length})),this.param.videoSequence.frames.forEach(((i,r)=>{t.set(new Uint8Array(i.fileBytes.data.data()),e),e+=i.fileBytes.length})),un(cn("mdat"),t)}mvhd(){return un(cn("mvhd"),new Uint8Array([0,0,0,0,...dn(ln),...dn(ln),...dn(this.param.timescale),...dn(this.param.duration),0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2]))}trak(t){return un(cn("trak"),this.tkhd(t),this.edts(t),this.mdia(t))}tkhd(t){return un(cn("tkhd"),new Uint8Array([0,0,0,1,...dn(ln),...dn(ln),...dn(t.id),0,0,0,0,...dn(t.duration),0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,t.width>>8&255,255&t.width,0,0,t.height>>8&255,255&t.height,0,0]))}edts(t){return un(cn("edts"),this.elst(t))}elst(t){return un(cn("elst"),new Uint8Array([0,0,0,0,...dn(1),...dn(t.duration),...dn(t.implicitOffset*Math.floor(t.duration/t.samples.length)),0,1,0,0]))}mdia(t){return un(cn("mdia"),this.mdhd(),this.hdlr(),this.minf(t))}mdhd(){return un(cn("mdhd"),new Uint8Array([0,0,0,0,...dn(ln),...dn(ln),...dn(this.param.timescale),...dn(0),85,196,0,0]))}hdlr(){return un(cn("hdlr"),new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]))}minf(t){return un(cn("minf"),this.vmhd(),this.dinf(),this.stbl(t))}vmhd(){return un(cn("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}dinf(){return un(cn("dinf"),this.dref())}dref(){return un(cn("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))}stbl(t){return un(cn("stbl"),this.stsd(t),this.stts(t),this.ctts(t),this.stss(t),this.stsc(),this.stsz(),this.stco())}stsd(t){return un(cn("stsd"),new Uint8Array([0,0,0,0,0,0,0,1]),this.avc1(t))}avc1(t){const e=[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255];return un(cn("avc1"),new Uint8Array(e),this.avcc(t))}avcc(t){let e=[],i=[];t.sps.forEach((t=>{const i=t.length-4;e.push(i>>>8&255),e.push(255&i),e=e.concat(Array.prototype.slice.call(new Uint8Array(t.data.data(),4)))})),t.pps.forEach((t=>{const e=t.length-4;i.push(e>>>8&255),i.push(255&e),i=i.concat(Array.prototype.slice.call(new Uint8Array(t.data.data(),4)))}));const r=[1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i);return un(cn("avcC"),new Uint8Array(r))}stts(t){return un(cn("stts"),new Uint8Array([0,0,0,0,...dn(1),...dn(t.samples.length),...dn(Math.floor(t.duration/t.samples.length))]))}ctts(t){const e=t.pts.length,i=Math.floor(t.duration/e),r=[0,0,0,0,...dn(e)];for(let n=0;n<e;n++){r.push(...dn(1));const e=n*i,s=(t.pts[n]+t.implicitOffset)*i;r.push(...dn(s-e))}return un(cn("ctts"),new Uint8Array(r))}stss(t){const e=t.samples.filter((t=>t.flags.isKeyFrame)).map((t=>t.index+1)),i=[0,0,0,0,...dn(e.length)];return e.forEach((t=>{i.push(...dn(t))})),un(cn("stss"),new Uint8Array(i))}stsc(){return un(cn("stsc"),new Uint8Array([0,0,0,0,0,0,0,0]))}stsz(){return un(cn("stsz"),new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))}stco(){return un(cn("stco"),new Uint8Array([0,0,0,0,0,0,0,0]))}mvex(){const t=this.param.tracks.map((t=>this.trex(t))).reverse();return un(cn("mvex"),...t)}trex(t){return un(cn("trex"),new Uint8Array([0,0,0,0,t.id>>24,t.id>>16&255,t.id>>8&255,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}mfhd(){return un(cn("mfhd"),new Uint8Array([0,0,0,0,this.param.sequenceNumber>>24,this.param.sequenceNumber>>16&255,this.param.sequenceNumber>>8&255,255&this.param.sequenceNumber]))}traf(){const t=this.sdtp();return this.param.offset=t.length+72,un(cn("traf"),this.tfhd(),this.tfdt(),this.trun(),t)}tfhd(){return un(cn("tfhd"),new Uint8Array([0,0,0,0,...dn(this.param.track.id)]))}tfdt(){return un(cn("tfdt"),new Uint8Array([0,0,0,0,...dn(this.param.baseMediaDecodeTime)]))}trun(){const t=(this.param.track.samples||[]).length,e=12+16*t;this.param.offset+=8+e;const i=[0,0,15,1,...dn(t),...dn(this.param.offset)];return this.param.track.samples.forEach((t=>{const{duration:e,size:r,flags:n,cts:s}=t;i.push(...dn(e)),i.push(...dn(r)),i.push(n.isLeading<<2|n.dependsOn),i.push(n.isDependedOn<<6|n.hasRedundancy<<4|0|n.isNonSync),i.push(61440&n.degradPrio),i.push(15&n.degradPrio),i.push(...dn(s))})),un(cn("trun"),new Uint8Array(i))}sdtp(){const t=new Uint8Array(4+this.param.track.samples.length);return this.param.track.samples.forEach(((e,i)=>{t[i+4]=e.flags.dependsOn<<4|e.flags.isDependedOn<<2|e.flags.hasRedundancy})),un(cn("sdtp"),t)}}var pn=Object.defineProperty,mn=Object.getOwnPropertySymbols,gn=Object.prototype.hasOwnProperty,yn=Object.prototype.propertyIsEnumerable,vn=(t,e,i)=>e in t?pn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,wn=(t,e)=>{for(var i in e||(e={}))gn.call(e,i)&&vn(t,i,e[i]);if(mn)for(var i of mn(e))yn.call(e,i)&&vn(t,i,e[i]);return t};const bn=t=>{const e=c?En(t):t,i=Sn(e);if(!i||0===i.len)throw new Error("mp4Track is empty");const r={offset:0,tracks:[i],track:i,duration:i.duration,timescale:i.timescale,sequenceNumber:1,baseMediaDecodeTime:0,nalusBytesLen:i.len,videoSequence:e},n=new fn(r);return(t=>{let e=0;for(const i of t)e+=i.byteLength;const i=new Uint8Array(e);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i})([n.ftyp(),n.moov(),n.moof(),n.mdat()])},Sn=t=>{if(t.headers.length<2)throw new Error("Bad header data in video sequence!");if(0===t.frames.length)throw new Error("There is no frame data in the video sequence!");const e={id:1,type:"video",timescale:6e3,duration:Math.floor(6e3*t.frames.length/t.frameRate),width:t.getVideoWidth(),height:t.getVideoHeight(),sps:[t.headers[0]],pps:[t.headers[1]],implicitOffset:xn(t.frames),len:0,pts:[],samples:[]},i=t.headers.reduce(((t,e)=>t+e.length),0),r=e.duration/t.frames.length;return t.frames.forEach(((t,n)=>{var s;let o=null!=(s=t.fileBytes.length)?s:0;0===n&&(o+=i),e.len+=o,e.pts.push(t.frame),e.samples.push({index:n,size:o,duration:r,cts:(t.frame+e.implicitOffset-n)*r,flags:{isKeyFrame:t.isKeyframe,isNonSync:t.isKeyframe?0:1,dependsOn:t.isKeyframe?2:1,isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}})})),e},xn=t=>Math.max(...t.map(((t,e)=>e-t.frame))),En=t=>{const e=t.frames.length;for(let i=0;i<t.frames.length;i++){const r=wn({},t.frames[i]);if(r.isKeyframe&&i>0)break;r.frame+=e,t.frames.push(r)}return t};let Tn={};const Pn=function(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n;e in Tn||(Tn[e]=[]),null==(n=Tn[e])||n.push({node:t,handler:i,capture:r}),t.addEventListener(e,i,r)};var Rn=Object.defineProperty,An=Object.getOwnPropertyDescriptor;const Cn=navigator&&/MicroMessenger/i.test(navigator.userAgent),Vn=async t=>{Cn&&window.WeixinJSBridge&&await new Promise((t=>{window.WeixinJSBridge.invoke("getNetworkType",{},(()=>{t()}),(()=>{t()}))}));try{await t.play()}catch(t){throw new Error(t.message)}};let kn=class{constructor(t){this.destroyed=!1,this.frameRate=0,this._duration=t.frameCount/t.frameRate,this.frameRate=t.frameRate}static create(t){const e=new kn(t),i=e.load(t);return{videoReader:e,debugData:i}}getVideoElement(){return this.videoElement}progress(){return Math.round(this.videoElement.currentTime/this._duration*100)/100}duration(){return this._duration}currentTime(){return this.videoElement.currentTime||0}start(){return Vn(this.videoElement)}pause(){var t;null==(t=this.videoElement)||t.pause()}seek(t){return new Promise((e=>{const i=()=>{var t,r,n,s,o,a,h;t=this.videoElement,n=i,(r="seeked")in Tn&&(n?(null==(s=Tn[r])||s.filter((e=>{let{node:i,handler:r}=e;return i===t&&r===n})).forEach((t=>{let{node:e,handler:i,capture:n}=t;return e.removeEventListener(r,i,n)})),Tn[r]=null==(o=Tn[r])?void 0:o.filter((e=>{let{node:i,handler:r}=e;return!(i===t&&r===n)}))):(null==(a=Tn[r])||a.filter((e=>{let{node:i}=e;return i===t})).forEach((t=>{let{node:e,handler:i,capture:n}=t;return e.removeEventListener(r,i,n)})),Tn[r]=null==(h=Tn[r])?void 0:h.filter((e=>{let{node:i}=e;return i!==t})))),e()};Pn(this.videoElement,"seeked",i),this.videoElement.currentTime=t}))}addListener(t,e){Pn(this.videoElement,t,e)}removeAllListeners(){var t;t=this.videoElement,Object.keys(Tn).forEach((e=>{var i,r;const n=e;null==(i=Tn[n])||i.filter((e=>{let{node:i}=e;return i===t})).forEach((t=>{let{node:e,handler:i,capture:r}=t;return e.removeEventListener(n,i,r)})),Tn[n]=null==(r=Tn[n])?void 0:r.filter((e=>{let{node:i}=e;return i!==t}))}))}getFrameData(t){}clearCallback(){}destroy(){this.removeAllListeners(),this.videoElement=void 0,this.destroyed=!0}load(t){this.videoElement=document.createElement("video"),this.videoElement.style.display="none",this.videoElement.muted=!0,this.videoElement.playsInline=!0;const e=new i,r=bn(t);return e.mark("coverMP4"),this.videoElement.src=URL.createObjectURL(new Blob([r],{type:"video/mp4"})),this.videoElement.load(),{coverMP4:e.measure("","coverMP4")}}};kn=((t,e,i,r)=>{for(var n,s=r>1?void 0:r?An(e,i):e,o=t.length-1;o>=0;o--)(n=t[o])&&(s=(r?n(e,i,s):n(s))||s);return r&&s&&Rn(e,i,s),s})([Mt],kn);var _n=Object.defineProperty,Ln=Object.getOwnPropertyDescriptor;navigator&&/MicroMessenger/i.test(navigator.userAgent);let Bn=class extends $t{constructor(t,e,i){super(t,e,i),this.fpsBuffer=[],this.currentFrame=-1,this.needSeek=!1,this.videoReader=this.createVideoReader(this.videoSequence)}async play(){this.playing||(this.playing=!0,await this.videoReader.start(),await this.flushLoop(),0===this.getProgress()&&this.eventManager.emit(Ft.onAnimationStart),this.eventManager.emit(Ft.onAnimationPlay))}pause(){this.playing&&(this.videoReader.pause(),this.clearTimer(),this.playing=!1,this.eventManager.emit(Ft.onAnimationPause))}stop(){this.videoReader.pause(),this.videoReader.seek(0),this.clearRender(),this.playing=!1,this.eventManager.emit(Ft.onAnimationCancel)}destroy(){this.clearTimer(),this.clearRender(),this.canvas=null,this.videoReader.destroy(),this.destroyed=!0}getProgress(){return this.currentFrame/this.videoSequence.frameCount}setProgress(t){if(t<0||t>1)throw new Error("progress must be between 0.0 and 1.0!");const e=Math.round(t*this.videoSequence.frameCount);this.currentFrame!==e&&(this.needSeek=!0,this.currentFrame=e)}flush(){return this.flushInternal(!0)}draw(){}createVideoReader(t){const{videoReader:e,debugData:i}=kn.create(t);return this.setDebugData(i),c||e.addListener("ended",(()=>{this.repeat()})),e}async repeat(){return 0===this.repeatCount?(this.setProgress(1),await this.flushInternal(!0),this.videoReader.pause(),this.clearTimer(),this.playing=!1,this.eventManager.emit("onAnimationEnd"),!1):(this.repeatCount-=1,c?await this.videoReader.seek(0):this.videoReader.start(),this.eventManager.emit("onAnimationRepeat"),!0)}flushLoop(){return this.renderTimer=window.requestAnimationFrame((()=>{this.flushLoop()})),c&&this.duration()-this.videoReader.currentTime()<=1/this.frameRate()&&this.repeat(),this.flushInternal(!1)}clearTimer(){this.renderTimer&&(window.cancelAnimationFrame(this.renderTimer),this.renderTimer=null)}updateFPS(){let t;try{t=performance.now()}catch(e){t=Date.now()}this.fpsBuffer=this.fpsBuffer.filter((e=>t-e<=1e3)),this.fpsBuffer.push(t),this.setDebugData({FPS:this.fpsBuffer.length})}async flushInternal(t){const e=new i;this.needSeek?(t?await this.videoReader.seek(this.currentFrame/this.frameRate()):this.videoReader.seek(this.currentFrame/this.frameRate()),this.needSeek=!1):this.currentFrame=Math.floor(this.videoReader.currentTime()*this.frameRate()),this.draw(),e.mark("draw"),this.setDebugData({draw:e.measure("","draw")}),this.updateFPS(),this.eventManager.emit(Ft.onAnimationUpdate)}};Bn=((t,e,i,r)=>{for(var n,s=r>1?void 0:r?Ln(e,i):e,o=t.length-1;o>=0;o--)(n=t[o])&&(s=(r?n(e,i,s):n(s))||s);return r&&s&&_n(e,i,s),s})([Mt],Bn);var Fn=Object.defineProperty,Un=Object.getOwnPropertyDescriptor;let Dn=class extends Bn{constructor(t,e,i){var r;super(t,e,i);const n=null==(r=this.canvas)?void 0:r.getContext("2d");if(!n)throw new Error("Can't get 2d context!");this.context=n,this.renderCanvas2D=document.createElement("canvas"),this.renderCanvas2D.width=this.videoParam.MP4Width,this.renderCanvas2D.height=this.videoParam.MP4Height;const s=this.renderCanvas2D.getContext("2d");if(!s)throw new Error("Can't get 2d context!");this.renderCanvas2DContext=s}draw(){if(this.videoParam.hasAlpha){this.renderCanvas2DContext.clearRect(0,0,this.renderCanvas2D.width,this.renderCanvas2D.height),this.renderCanvas2DContext.drawImage(this.videoReader.getVideoElement(),0,0,this.renderCanvas2D.width,this.renderCanvas2D.height);const t=this.renderCanvas2DContext.getImageData(0,0,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight),e=this.renderCanvas2DContext.getImageData(this.videoParam.alphaStartX,this.videoParam.alphaStartY,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight),i=t.data.length/4;for(let r=0;r<i;r++)t.data[4*r+3]=e.data[4*r+0];this.renderCanvas2DContext.clearRect(0,0,this.renderCanvas2D.width,this.renderCanvas2D.height),this.renderCanvas2DContext.putImageData(t,0,0,0,0,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.renderCanvas2D,0,0,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight,this.viewportSize.x,this.viewportSize.y,this.viewportSize.width,this.viewportSize.height)}else this.context.drawImage(this.videoReader.getVideoElement(),0,0,this.videoParam.MP4Width,this.videoParam.MP4Height,this.viewportSize.x,this.viewportSize.y,this.viewportSize.width,this.viewportSize.height)}clearRender(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};Dn=((t,e,i,r)=>{for(var n,s=r>1?void 0:r?Un(e,i):e,o=t.length-1;o>=0;o--)(n=t[o])&&(s=(r?n(e,i,s):n(s))||s);return r&&s&&Fn(e,i,s),s})([Mt],Dn);const Mn="\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      \n      uniform vec2 u_resolution;\n      uniform vec2 u_scale;\n      \n      varying vec2 v_texCoord;\n    \n      \n      void main() {\n         // convert the rectangle from pixels to 0.0 to 1.0\n         vec2 zeroToOne = a_position / u_resolution;\n      \n         // convert from 0->1 to 0->2\n         vec2 zeroToTwo = zeroToOne * 2.0;\n      \n         // convert from 0->2 to -1->+1 (clipspace)\n         vec2 clipSpace = zeroToTwo - 1.0;\n      \n         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n      \n         // pass the texCoord to the fragment shader\n         // The GPU will interpolate this value between points.\n         v_texCoord = a_texCoord / u_scale;\n      }\n        ";var In=Object.defineProperty,On=Object.getOwnPropertyDescriptor,qn=Object.getOwnPropertySymbols,jn=Object.prototype.hasOwnProperty,zn=Object.prototype.propertyIsEnumerable,Nn=(t,e,i)=>e in t?In(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;let Gn=class extends Bn{constructor(t,e,i){var r;super(t,e,i),this.scale={x:1,y:1},this.positionLocation=0,this.texcoordLocation=0,this.alphaStartLocation=null,this.scaleLocation=null,this.resolutionLocation=null,this.positionBuffer=null,this.texcoordBuffer=null,this.originalVideoTexture=null,this.renderingTexture=null,this.renderingFbo=null;const n=null==(r=this.canvas)?void 0:r.getContext("webgl",((t,e)=>{for(var i in e||(e={}))jn.call(e,i)&&Nn(t,i,e[i]);if(qn)for(var i of qn(e))zn.call(e,i)&&Nn(t,i,e[i]);return t})({},a));if(!n)throw new Error("Can't get WebGL context!");this.gl=n,this.videoParam.hasAlpha?this.program=It(this.gl,qt(Mn),qt("\n      precision mediump float;\n      // our texture\n      uniform sampler2D u_image;\n      \n      // the texCoords passed in from the vertex shader.\n      varying vec2 v_texCoord;\n      uniform vec2 v_alphaStart;\n      \n      void main() {\n         vec4 color = texture2D(u_image, v_texCoord);\n         vec4 alpha = texture2D(u_image, vec2(v_texCoord.x + v_alphaStart.x, v_texCoord.y + v_alphaStart.y));\n         gl_FragColor = vec4(color.rgb * alpha.r, alpha.r);\n      }     \n         ")):this.program=It(this.gl,qt(Mn),qt("\n      precision mediump float;\n      // our texture\n      uniform sampler2D u_image;\n      \n      // the texCoords passed in from the vertex shader.\n      varying vec2 v_texCoord;\n      \n      void main() {\n         gl_FragColor = texture2D(u_image, v_texCoord);\n      }\n         ")),this.loadContext()}loadContext(){if(!this.program)throw new Error("program is not initialized");if(this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),-1===this.positionLocation)throw new Error("unable to get attribute location for a_position");if(this.scaleLocation=this.gl.getUniformLocation(this.program,"u_scale"),-1===this.scaleLocation)throw new Error("unable to get attribute location for u_scale");if(this.texcoordLocation=this.gl.getAttribLocation(this.program,"a_texCoord"),-1===this.texcoordLocation)throw new Error("unable to get attribute location for a_texCoord");if(this.videoParam.hasAlpha&&(this.alphaStartLocation=this.gl.getUniformLocation(this.program,"v_alphaStart"),!this.alphaStartLocation))throw new Error("unable to get attribute location for v_alphaStart");if(this.resolutionLocation=this.gl.getUniformLocation(this.program,"u_resolution"),-1===this.positionLocation)throw new Error("unable to get attribute location for u_resolution");if(this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.setRectangle(this.gl,0,0,this.videoParam.MP4Width,this.videoParam.MP4Height),this.texcoordBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this.gl.STATIC_DRAW),this.renderingTexture=jt(this.gl),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.renderingFbo=this.gl.createFramebuffer(),!this.renderingFbo)throw new Error("unable to create framebuffer");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.renderingFbo),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.renderingTexture,0),this.originalVideoTexture=jt(this.gl)}draw(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.originalVideoTexture),this.texImage2D(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);const t=this.gl.FLOAT;this.gl.vertexAttribPointer(this.positionLocation,2,t,false,0,0),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.vertexAttribPointer(this.texcoordLocation,2,t,false,0,0),this.videoParam.hasAlpha&&this.gl.uniform2f(this.alphaStartLocation,this.videoParam.alphaStartX/this.videoParam.MP4Width/this.scale.x,this.videoParam.alphaStartY/this.videoParam.MP4Height/this.scale.y),this.gl.bindTexture(this.gl.TEXTURE_2D,this.originalVideoTexture),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.renderingFbo),this.gl.uniform2f(this.resolutionLocation,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight),this.gl.uniform2f(this.scaleLocation,this.scale.x,this.scale.y),this.gl.viewport(0,0,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight);const e=this.gl.TRIANGLES;this.gl.drawArrays(e,0,6),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.uniform2f(this.resolutionLocation,this.videoParam.sequenceWidth,this.videoParam.sequenceHeight),this.gl.viewport(this.viewportSize.x,this.viewportSize.y,this.viewportSize.width,this.viewportSize.height),this.gl.drawArrays(e,0,6)}clearRender(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}detectWebGLContext(){return(()=>{const t=document.createElement("canvas");return!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))})()}texImage2D(){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.videoReader.getVideoElement())}setRectangle(t,e,i,r,n){const s=e,o=e+r,a=i,h=i+n;t.bufferData(t.ARRAY_BUFFER,new Float32Array([s,a,o,a,s,h,s,h,o,a,o,h]),t.STATIC_DRAW)}};Gn=((t,e,i,r)=>{for(var n,s=r>1?void 0:r?On(e,i):e,o=t.length-1;o>=0;o--)(n=t[o])&&(s=(r?n(e,i,s):n(s))||s);return r&&s&&In(e,i,s),s})([Mt],Gn);var Wn=Object.defineProperty,Hn=Object.getOwnPropertySymbols,Xn=Object.prototype.hasOwnProperty,Kn=Object.prototype.propertyIsEnumerable,Yn=(t,e,i)=>e in t?Wn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;t.PAGView=class{static init(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=((t,e)=>{for(var i in e||(e={}))Xn.call(e,i)&&Yn(t,i,e[i]);if(Hn)for(var i of Hn(e))Kn.call(e,i)&&Yn(t,i,e[i]);return t})({renderingMode:Bt.WebGL},r),s=new i,o=Vt.fromArrayBuffer(t);let a;return s.mark("decode"),a=n.renderingMode===Bt.WebGL?new Gn(o,e,n):new Dn(o,e,n),a.setDebugData({decodePAGFile:s.measure("","decode")}),a}},t.types=Dt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=pag.babel.js.map
